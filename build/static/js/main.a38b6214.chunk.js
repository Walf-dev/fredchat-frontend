(this.webpackJsonpfredchat=this.webpackJsonpfredchat||[]).push([[0],{123:function(e,t,n){},125:function(e,t,n){},139:function(e,t,n){},140:function(e,t,n){},141:function(e,t,n){},142:function(e,t,n){},143:function(e,t,n){},144:function(e,t,n){},146:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){},149:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(39),i=n.n(s),r=(n(123),n(10)),o=n(5),u=n(30),l=n(18),d=n.n(l),A=n(194),h=n(65),g=n.n(h),j=n(75),m=n.n(j),f=n(91),b=n.n(f),p=n(44),O=n.n(p),v=(n(125),n(38)),w=n(195),I=n(19),x=n(9);function E(){if(window.innerHeight>768&&window.innerWidth>1366){var e=window.innerHeight/window.innerWidth,t=768/1366;return t<e?{width:1366,height:window.innerHeight*(1366/window.innerWidth),transform:"scale(".concat(window.innerWidth/1366,")")}:t>e?{width:window.innerWidth*(768/window.innerHeight),height:768,transform:"scale(".concat(window.innerHeight/768,")")}:{width:1366,height:768,transform:"scale(".concat(window.innerHeight/768,")")}}return{width:window.innerWidth,height:window.innerHeight,transform:"scale(1)"}}var C={user:null,path:"",pathID:"",dispatchMessages:{},audioID:null,roomsData:{},page:E()},S={SET_USER:"SET_USER",SET_MESSAGES:"SET_MESSAGES"},y=function(e,t){var n;switch(t.type){case"set_scale_page":return Object(r.a)(Object(r.a)({},e),{},{page:t.page});case S.SET_USER:return Object(r.a)(Object(r.a)({},e),{},{user:t.user});case"SET_PATH":return Object(r.a)(Object(r.a)({},e),{},{path:t.path});case"set_path_id":return Object(r.a)(Object(r.a)({},e),{},{pathID:t.id});case S.SET_MESSAGES:var a=e.dispatchMessages;if(t.update){if(a[t.id].messages)if(0===a[t.id].messages.length)t.messages.length>0&&(a[t.id]={messages:t.messages,limitReached:a[t.id].limitReached,firstMessageID:a[t.id].firstMessageID,audio:e.pathID===t.id});else if(a[t.id].messages.length>0&&0===t.messages.length)a[t.id]={messages:[],limitReached:!0,firstMessageID:void 0,audio:!1};else{var c,s=a[t.id].messages.length-t.messages.length,i=0!==s;if(s>=0)for(var o=0;o<t.messages.length-2&&(i=t.messages[o].id===a[t.id].messages[s+o+1].id);o++);else for(o=0;o<a[t.id].messages.length-2&&(i=t.messages[o].id===a[t.id].messages[o].id);o++);if(i)c=s>=0?[].concat(Object(I.a)(a[t.id].messages.slice(0,s+1)),Object(I.a)(t.messages)):Object(I.a)(t.messages),a[t.id]={messages:c,limitReached:a[t.id].limitReached,firstMessageID:a[t.id].firstMessageID,audio:e.pathID===t.id&&i}}return Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:a})}return a[t.id]={messages:t.messages,limitReached:"no id"===a[t.id].firstMessageID||(null===(n=t.messages[0])||void 0===n?void 0:n.id)===a[t.id].firstMessageID,firstMessageID:a[t.id].firstMessageID,audio:!1},Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:a});case"set_audio_false":var u=e.dispatchMessages;return u[t.id]=Object(r.a)(Object(r.a)({},u[t.id]),{},{audio:!1}),Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:u});case"set_firstMessage":var l=e.dispatchMessages;return l[t.id]?l[t.id].firstMessageID=t.firstMessageID:l[t.id]={firstMessageID:t.firstMessageID},Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:l});case"update_media":var d=e.dispatchMessages,A=d[t.roomID].messages,h=A.findIndex((function(e){return e.id===t.id}));return A[h]=Object(r.a)(Object(r.a)({},A[h]),t.data),d[t.roomID]={messages:A,limitReached:d[t.roomID].limitReached,firstMessageID:d[t.roomID].firstMessageID},Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:d});case"add_rooms_data":var g=Object(r.a)({},e.roomsData);return g[t.roomID]={lastMessageListener:t.lastMessageListener,onlineStatelistener:t.onlineStatelistener,roomID:t.roomID},Object(r.a)(Object(r.a)({},e),{},{roomsData:g});case"update_rooms_data":var j=Object(r.a)({},e.roomsData);return t.data!==j[t.roomID][t.dataType]?(j[t.roomID]=Object(r.a)(Object(r.a)({},j[t.roomID]),{},Object(x.a)({},t.dataType,t.data)),Object(r.a)(Object(r.a)({},e),{},{roomsData:j})):e;default:return e}},B=n(2),Q=Object(a.createContext)(),D=function(e){var t=e.reducer,n=e.initialState,c=e.children;return Object(B.jsx)(Q.Provider,{value:[].concat(Object(I.a)(Object(a.useReducer)(t,n)),[S]),children:c})},k=function(){return Object(a.useContext)(Q)};function M(e){var t=e.dataList,n=e.title,c=e.path,s=e.fetchList,i=k(),r=Object(o.a)(i,2),u=r[0],l=u.roomsData,d=u.page,h=u.pathID,j=r[1],f=Object(a.useState)(!1),p=Object(o.a)(f,2),I=p[0],x=p[1],E=Object(a.useState)(null),C=Object(o.a)(E,2),S=C[0],y=C[1],Q=Object(a.useRef)();return Object(a.useEffect)((function(){var e=null;s&&(e=function(){parseInt(Q.current.scrollTop)===Q.current.scrollHeight-Q.current.offsetHeight&&s(x)},(null===t||void 0===t?void 0:t.length)>0&&Q.current.addEventListener("scroll",e));var n=Q.current;return function(){e&&n.removeEventListener("scroll",e)}}),[t,s]),Object(a.useEffect)((function(){(null===t||void 0===t?void 0:t.length)===(null===S||void 0===S?void 0:S.length)&&setTimeout((function(){Array.from(document.querySelectorAll(".animate")).forEach((function(e,t){setTimeout((function(){e.classList.remove("animate")}),50*t)}))}),10)}),[t,S]),Object(a.useEffect)((function(){if(t){var e=[];t.forEach((function(t){if(t){var a,s,i=null!==(a=l[t.id])&&void 0!==a&&a.onlineState?l[t.id].onlineState:t.state,r="Search Result"===n?null:null!==(s=l[t.id])&&void 0!==s&&s.lastMessage?l[t.id].lastMessage:t.lastMessage;("Rooms"===n||"Search Result"===n||"Chats"===n&&l[t.id].lastMessage||"Chats"!==n&&l[t.id])&&e.push(Object(B.jsx)(v.b,{className:"link",to:{pathname:c?"".concat(c,"/room/").concat(t.id):"/room/".concat(t.id),state:{photoURL:"".concat(t.photoURL?t.photoURL:"https://avatars.dicebear.com/api/human/".concat(t.id,".svg")),name:t.name,userID:t.userID?t.userID:null,state:t.state}},children:Object(B.jsxs)("div",{className:"sidebar__chat animate",children:[Object(B.jsxs)("div",{className:"avatar__container",children:[Object(B.jsx)(A.a,{style:{width:45,height:45},src:"".concat(t.photoURL?t.photoURL:"https://avatars.dicebear.com/api/human/".concat(t.id,".svg"))}),"online"===i?Object(B.jsx)("div",{className:"online"}):null]}),Object(B.jsxs)("div",{className:"sidebar__chat--info",children:[Object(B.jsx)("h2",{dangerouslySetInnerHTML:{__html:"Search Result"===n?t._highlightResult.name.value:t.name},style:{width:d.width<=760?d.width-126:.315*d.width-126,marginBottom:null!==r&&void 0!==r&&r.message||r?8:0}}),Object(B.jsx)("p",{style:{width:d.width<=760?d.width-126:.315*d.width-126},children:null!==r&&void 0!==r&&r.message?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(m.a,{style:{width:19,height:19}})," ",Object(B.jsx)("span",{style:{width:d.width<=760?d.width-150:.315*d.width-150},children:r.message})," "]}):null!==r&&void 0!==r&&r.audio?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(g.a,{style:{width:19,height:19}}),Object(B.jsx)("span",{style:{width:d.width<=760?d.width-150:.315*d.width-150},children:r.time})]}):""===(null===r||void 0===r?void 0:r.message)?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(m.a,{style:{width:19,height:19}})," ",Object(B.jsx)("span",{style:{width:d.width<=760?d.width-150:.315*d.width-150},children:"Photo"})," "]}):r})]}),null!==t&&void 0!==t&&t.unreadMessages&&h!==t.id?Object(B.jsx)("div",{className:"sidebar__chat--unreadMessages",children:Object(B.jsx)("div",{children:t.unreadMessages})}):null]})},t.id))}else e.push(null)})),y(e)}}),[t,l,d,h]),Object(a.useEffect)((function(){d.width<=760?j({type:"SET_PATH",path:c}):j({type:"SET_PATH",path:""})}),[c,d]),Object(B.jsxs)("div",{ref:Q,className:"sidebar__chat--container",children:[Object(B.jsxs)("h2",{className:"animate",children:[n," "]}),(null===t||void 0===t?void 0:t.length)>0?S:null===t&&"Chats"!==n?Object(B.jsx)("div",{className:"loader__container sidebar__loader",children:Object(B.jsx)(w.a,{})}):Object(B.jsxs)("div",{className:"no-result",children:[Object(B.jsxs)("div",{children:[Object(B.jsx)(b.a,{}),Object(B.jsx)("div",{className:"cancel-root",children:Object(B.jsx)(O.a,{})})]}),Object(B.jsxs)("h2",{children:["No ",n," found "]})]}),Object(B.jsx)("div",{className:"loader__container scrollFetch",children:I?Object(B.jsx)(w.a,{}):null})]})}var R=Object(a.memo)(M),L=n(196),N=n(93),_=n.n(N),U=n(94),H=n.n(U),J=n(95),P=n.n(J),T=n(96),Y=n.n(T),W=n(97),F=n.n(W),G=n(98),q=n.n(G),z=n(99),X=n.n(z),K=n(35),Z=(n(134),n(152),n(136),n(151),n(153),K.a.initializeApp({apiKey:"AIzaSyDBAA9fds7TLHmYzYGsd1FxdO9_0adAdnA",authDomain:"walfchat.firebaseapp.com",databaseURL:"https://walfchat-default-rtdb.firebaseio.com",projectId:"walfchat",storageBucket:"walfchat.appspot.com",messagingSenderId:"840763157061",appId:"1:840763157061:web:ebfcb5307fe2794e05512c",measurementId:"G-NR6C5HBKPW"})),V=(Z.firestore().enablePersistence(),Z.firestore()),$=Z.database(),ee=Z.auth(),te=new K.a.auth.GoogleAuthProvider,ne=new K.a.auth.FacebookAuthProvider,ae=K.a.firestore.FieldValue.serverTimestamp,ce=K.a.database.ServerValue.TIMESTAMP,se="serviceWorker"in navigator&&"PushManager"in window?K.a.messaging():null,ie=K.a.firestore.FieldValue.increment,re=(K.a.firestore.FieldValue.arrayUnion,K.a.storage().ref("images")),oe=K.a.storage().ref("audios");K.a.storage().ref("videos"),K.a.storage().ref("documents");var ue=V,le=n(22),de=n(92),Ae=n.n(de),he=(n(139),n.p+"static/media/notification.d63feaf4.mp3"),ge=Ae()("JIMBGKZ8LO","f050ba62d4f7458801bbfb4c7b315ad8").initIndex("chatapp");function je(e){var t,n=e.chats,c=e.pwa,s=e.rooms,i=e.fetchRooms,l=e.users,h=e.fetchUsers,g=Object(a.useState)(null),j=Object(o.a)(g,2),m=j[0],f=j[1],b=Object(a.useState)(""),p=Object(o.a)(b,2),O=p[0],w=p[1],I=Object(a.useState)(1),x=Object(o.a)(I,2),E=x[0],C=x[1],S=Object(a.useState)(!1),y=Object(o.a)(S,2),Q=y[0],D=y[1],M=k(),N=Object(o.a)(M,1)[0],U=N.user,J=N.page,T=N.pathID,W=Object(le.g)(),G=new Audio(he),z=Object(a.useRef)(function(){var e={};return n.forEach((function(t){return t.unreadMessages||0===t.unreadMessages?e[t.id]=t.unreadMessages:null})),e}());function K(){return(K=Object(u.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(document.querySelector(".sidebar__search input").blur(),t.preventDefault()),J.width<=760&&W.push("/search?"+O),f(null),4!==E&&C(4),e.next=6,ge.search(O);case 6:n=e.sent.hits.map((function(e){return e.objectID!==U.uid?Object(r.a)(Object(r.a)({},e),{},{id:e.photoURL?e.objectID>U.uid?e.objectID+U.uid:U.uid+e.objectID:e.objectID,userID:e.photoURL?e.objectID:null}):null})),f(n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t=J.width>760?function(e){return Object(B.jsx)("div",{className:"".concat(e.classSelected?"sidebar__menu--selected":""),onClick:e.click,children:e.children})}:v.c;return Object(a.useEffect)((function(){var e={};n.forEach((function(t){(t.unreadMessages||0===t.unreadMessages)&&((t.unreadMessages>z.current[t.id]||!z.current[t.id]&&0!==z.current[t.id])&&T!==t.id&&G.play(),e[t.id]=t.unreadMessages)})),z.current=e}),[n,T]),Object(a.useEffect)((function(){J.width<=760&&n&&!Q&&(D(!0),setTimeout((function(){document.querySelector(".sidebar").classList.add("side")}),10))}),[n,Q]),Object(B.jsxs)("div",{className:"sidebar",style:{minHeight:J.width<=760?J.height:"auto"},children:[Object(B.jsxs)("div",{className:"sidebar__header",children:[Object(B.jsxs)("div",{className:"sidebar__header--left",children:[Object(B.jsx)(A.a,{src:null===U||void 0===U?void 0:U.photoURL}),Object(B.jsxs)("h4",{children:[null===U||void 0===U?void 0:U.displayName," "]})]}),Object(B.jsxs)("div",{className:"sidebar__header--right",children:[Object(B.jsx)(L.a,{onClick:function(){c?(console.log("prompting the pwa event"),c.prompt()):console.log("pwa event is undefined")},children:Object(B.jsx)(_.a,{})}),Object(B.jsx)(L.a,{onClick:function(){ee.signOut(),ue.doc("/users/"+U.uid).set({state:"offline"},{merge:!0}),W.replace("/chats")},children:Object(B.jsx)(H.a,{})})]})]}),Object(B.jsx)("div",{className:"sidebar__search",children:Object(B.jsxs)("form",{className:"sidebar__search--container",children:[Object(B.jsx)(P.a,{}),Object(B.jsx)("input",{value:O,onChange:function(e){return w(e.target.value)},placeholder:"Search for users or rooms",type:"text"}),Object(B.jsx)("button",{style:{display:"none"},type:"submit",onClick:function(e){return K.apply(this,arguments)}})]})}),Object(B.jsxs)("div",{className:"sidebar__menu",children:[Object(B.jsx)(t,{classSelected:1===E,to:"/chats",click:function(){return C(1)},activeClassName:"sidebar__menu--selected",children:Object(B.jsxs)("div",{className:"sidebar__menu--home",children:[Object(B.jsx)(Y.a,{}),Object(B.jsx)("div",{className:"sidebar__menu--line"})]})}),Object(B.jsx)(t,{classSelected:2===E,to:"/rooms",click:function(){return C(2)},activeClassName:"sidebar__menu--selected",children:Object(B.jsxs)("div",{className:"sidebar__menu--rooms",children:[Object(B.jsx)(F.a,{}),Object(B.jsx)("div",{className:"sidebar__menu--line"})]})}),Object(B.jsx)(t,{classSelected:3===E,to:"/users",click:function(){return C(3)},activeClassName:"sidebar__menu--selected",children:Object(B.jsxs)("div",{className:"sidebar__menu--users",children:[Object(B.jsx)(q.a,{}),Object(B.jsx)("div",{className:"sidebar__menu--line"})]})})]}),J.width<=760?Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)(le.d,{children:[Object(B.jsx)(le.b,{path:"/users",children:Object(B.jsx)(R,{fetchList:h,dataList:l,title:"Users",path:"/users"},"users")}),Object(B.jsx)(le.b,{path:"/rooms",children:Object(B.jsx)(R,{fetchList:i,dataList:s,title:"Rooms",path:"/rooms"},"rooms")}),Object(B.jsx)(le.b,{path:"/search",children:Object(B.jsx)(R,{dataList:m,title:"Search Result",path:"/search"},"search")}),Object(B.jsx)(le.b,{path:"/chats",children:Object(B.jsx)(R,{dataList:n,title:"Chats",path:"/chats"},"chats")})]})}):1===E?Object(B.jsx)(R,{dataList:n,title:"Chats"},"chats"):2===E?Object(B.jsx)(R,{fetchList:i,dataList:s,title:"Rooms"},"rooms"):3===E?Object(B.jsx)(R,{fetchList:h,dataList:l,title:"Users"},"users"):4===E?Object(B.jsx)(R,{dataList:m,title:"Search Result"},"search"):null,Object(B.jsx)("div",{className:"sidebar__chat--addRoom",onClick:function(){var e=prompt("Type the name of your room");e&&ue.collection("rooms").add({name:e,timestamp:ae(),lastMessage:""})},children:Object(B.jsx)(L.a,{children:Object(B.jsx)(X.a,{})})})]})}var me=Object(a.memo)(je),fe=n(186),be=n(189),pe=n(190),Oe=n(192),ve=n(112),we=n(107),Ie=n.n(we),xe=n(108),Ee=n.n(xe),Ce=n(109),Se=n.n(Ce),ye=n(110),Be=n.n(ye),Qe=n(106),De=n.n(Qe),ke=(n(140),Object(a.memo)((function(e){var t=e.imageSRC,n=e.mediaPreview,c=e.close,s=Object(a.useState)(""),i=Object(o.a)(s,2),r=i[0],u=i[1];return Object(a.useEffect)((function(){u(document.querySelector(".chat__body--container").offsetHeight)}),[]),Object(B.jsxs)("div",{ref:n,className:"mediaPreview",style:{height:r},children:[Object(B.jsx)(O.a,{onClick:c}),Object(B.jsx)("img",{src:t,alt:""},t)]})}))),Me=(n(141),Object(a.memo)((function(e){var t=e.imagePreview,n=e.animState,c=Object(le.g)(),i=Object(a.useState)(!1),r=Object(o.a)(i,2),u=r[0],l=r[1],d=k(),A=Object(o.a)(d,1)[0].page;Object(a.useEffect)((function(){if(u){var e,a,c,s=A.height/A.width,i=document.querySelector(".imagePreview-container"),r=t.ratio?t.ratio:t.imgH/t.imgW;s<r?(c=!0,e=1/r*A.height,a=A.height):(c=!1,a=r*A.width,e=A.width),"entering"===n||"entered"===n?setTimeout((function(){document.querySelector(".imagePreview").style.backgroundColor="black",i.style.borderRadius="0px",i.style.transformOrigin="0% 0%",i.style.height=t.imgH+"px",i.style.transform=c?"translateX(".concat(A.width/2-e/2,"px) translateY(0px) scale(").concat(A.height/t.imgH,")"):"translateX(0px) translateY(".concat(A.height/2-a/2,"px) scale(").concat(A.width/t.width,")"),setTimeout((function(){document.querySelector(".imagePreview .MuiSvgIcon-root").classList.add("close-animate")}),300)}),10):"exiting"===n&&setTimeout((function(){document.querySelector(".imagePreview .MuiSvgIcon-root").classList.remove("close-animate"),setTimeout((function(){document.querySelector(".imagePreview").style.backgroundColor="transparent"}),200),i.style.borderRadius="10px",i.style.height=t.height+"px",i.style.transform="translateX(".concat(t.left,"px) translateY(").concat(t.top,"px) scale(1)")}),10)}}),[n,u]);var h={transform:"translateX(".concat(t.left,"px) translateY(").concat(t.top,"px) scale(1)"),width:t.width,height:t.height},g={};return A.height/A.width>t.ratio||A.height/A.width===t.ratio?g.minWidth="100%":(g.minHeight="100%",t.imgW<t.width&&(g.minWidth="100%")),Object(s.createPortal)(Object(B.jsxs)("div",{className:"imagePreview",onClick:function(){return document.querySelector(".imagePreview .MuiSvgIcon-root").classList.toggle("close-animate")},children:[Object(B.jsx)(O.a,{onClick:function(){return c.goBack()}}),Object(B.jsx)("div",{className:"imagePreview-container",style:h,children:Object(B.jsx)("img",{style:g,onLoad:function(){return l(!0)},src:t.src,alt:""})})]}),document.querySelector(".app"))}))),Re=n(100),Le=n.n(Re),Ne=n(101),_e=n.n(Ne),Ue=n(187);function He(){return new Promise((function(e){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){var n=new MediaRecorder(t),a=[];n.addEventListener("dataavailable",(function(e){a.push(e.data)}));e({start:function(){n.start()},stop:function(){return new Promise((function(e){n.addEventListener("stop",(function(){var t=Object(Ue.a)(),n=new File(a,t,{type:"audio/mpeg"}),c=URL.createObjectURL(n),s=new Audio(c);e({audioFile:n,audioUrl:c,play:function(){s.play()},audioName:t})})),n.stop()}))}})}))}))}n(142);var Je=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Pe=Object(a.memo)((function(e){var t=e.input,n=e.handleFocus,c=e.change,s=e.sendMessage,i=e.setFocus,r=e.image,l=e.focus,A=e.state,h=e.token,j=e.roomID,m=e.setAudioID,f=Object(a.useState)(!1),b=Object(o.a)(f,2),p=b[0],v=b[1],w=Object(a.useState)("00:00"),I=Object(o.a)(w,2),E=I[0],C=I[1],S=k(),y=Object(o.a)(S,1)[0].user,Q=Object(a.useRef)(),D=Object(a.useRef)(),M=Object(a.useRef)(),R=Object(a.useRef)();function L(e,t,n){return N.apply(this,arguments)}function N(){return N=Object(u.a)(d.a.mark((function e(t,n,a){var c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ue.collection("rooms").doc(j).set(Object(x.a)({},y.uid,!1),{merge:!0}),ue.collection("rooms").doc(j).set({lastMessage:{audio:!0,time:n},seen:!1},{merge:!0}),A.userID?(ue.collection("users").doc(A.userID).collection("chats").doc(j).set({timestamp:ae(),photoURL:y.photoURL?y.photoURL:null,name:y.displayName,userID:y.uid,unreadMessages:ie(1)},{merge:!0}),ue.collection("users").doc(y.uid).collection("chats").doc(j).set({timestamp:ae(),photoURL:A.photoURL?A.photoURL:null,name:A.name,userID:A.userID},{merge:!0})):ue.collection("users").doc(y.uid).collection("chats").doc(j).set({timestamp:ae(),photoURL:A.photoURL?A.photoURL:null,name:A.name}),e.next=6,ue.collection("rooms").doc(j).collection("messages").add({name:y.displayName,uid:y.uid,timestamp:ae(),time:(new Date).toUTCString(),audioUrl:"uploading",audioName:a,audioPlayed:!1});case 6:return c=e.sent,e.next=9,oe.child(a).put(t);case 9:return e.next=11,oe.child(a).getDownloadURL();case 11:s=e.sent,ue.collection("rooms").doc(j).collection("messages").doc(c.id).update({audioUrl:s}),A.userID&&""!==h&&ue.collection("notifications").add({userID:y.uid,title:y.displayName,body:"\ud83c\udf99\ufe0f "+n,photoURL:y.photoURL,token:h});case 15:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function _(){return(_=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!window.navigator.onLine){e.next=15;break}return l&&D.current.focus(),e.next=5,Je(150);case 5:return e.next=7,He();case 7:return R.current=e.sent,m(null),D.current.style.width="calc(100% - 56px)",e.next=12,Je(305);case 12:v(!0),e.next=16;break;case 15:alert("No access to internet !!!");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return H.apply(this,arguments)}function H(){return(H=Object(u.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l&&D.current.focus(),ue.collection("rooms").doc(j).set(Object(x.a)({},y.uid,!1),{merge:!0}),clearInterval(M.current),t=R.current.stop(),Q.current.style.opacity="0",e.next=7,Je(300);case 7:return v(!1),D.current.style.width="calc(100% - 112px)",n=E,C("00:00"),e.abrupt("return",[t,n]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=Object(u.a)(d.a.mark((function e(){var t,n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return t=e.sent,n=Object(o.a)(t,2),a=n[0],c=n[1],e.next=8,a;case 8:L((a=e.sent).audioFile,c,a.audioName);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){var t=e+"";return t.length<2?"0"+t:t}function T(){var e=Date.now();M.current=setInterval((function(){var t=Date.now()-e,n=Math.floor(t/1e3);C(P(parseInt(n/60))+":"+P(n%60))}),100)}Object(a.useEffect)((function(){var e=function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(10);case 2:return Q.current.style.opacity="1",e.next=5,Je(100);case 5:T(),ue.collection("rooms").doc(j).set(Object(x.a)({},y.uid,"recording"),{merge:!0}),R.current.start();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();p&&e()}),[p]);var Y=Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(pe.a,{in:""!==t||""===t&&r,timeout:{enter:400,exit:200},classNames:"send__animate2",children:Object(B.jsx)(Le.a,{style:{width:20,height:20,color:"white"}})}),Object(B.jsx)(pe.a,{in:!(""!==t||""===t&&r),timeout:{enter:400,exit:200},classNames:"send__animate",children:Object(B.jsx)(g.a,{style:{width:24,height:24,color:"white"}})})]});return Object(B.jsxs)("div",{className:"chat__footer",onBlur:function(e){e.currentTarget.contains(e.relatedTarget)||p||i(!1)},children:[Object(B.jsxs)("form",{children:[Object(B.jsx)("input",{ref:D,value:t,onClick:n,onChange:p?null:c,onKeyPress:p?function(){return!1}:null,onFocus:function(){return i(!0)},placeholder:"Type a message"}),navigator.mediaDevices.getUserMedia&&window.MediaRecorder?Object(B.jsx)("button",{type:"submit",class:"send__btn",onClick:""!==t||""===t&&r?s:function(e){return _.apply(this,arguments)},children:Y}):Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)("label",{for:"capture",class:"send__btn",children:Y}),Object(B.jsx)("input",{style:{display:"none"},type:"file",id:"capture",accept:"audio/*",capture:!0,onChange:function(e){if(window.navigator.onLine){var t=e.target.files[0];if(t){m(null);var n=new Audio(URL.createObjectURL(t));n.addEventListener("loadedmetadata",(function(){var e=Math.floor(n.duration),a=P(parseInt(e/60))+":"+P(e%60);L(t,a,Object(Ue.a)())}))}}else alert("No access to internet !!!")}})]})]}),p?Object(B.jsxs)("div",{ref:Q,className:"record",children:[Object(B.jsx)(O.a,{style:{width:30,height:30,color:"#F20519"},onClick:U}),Object(B.jsxs)("div",{children:[Object(B.jsx)("div",{className:"record__redcircle"}),Object(B.jsx)("div",{className:"record__duration",children:E})]}),Object(B.jsx)(_e.a,{style:{width:30,height:30,color:"#41BF49"},onClick:function(){return J.apply(this,arguments)}})]}):null]})})),Te=n(102),Ye=n.n(Te),We=n(67),Fe=n(104),Ge=n.n(Fe),qe=n(103),ze=n.n(qe),Xe=n(105),Ke=n.n(Xe),Ze=(n(143),Object(a.memo)((function(e){var t=e.sender,n=e.roomID,c=e.audioUrl,s=e.id,i=e.setAudioID,r=e.audioID,l=e.animState,A=e.audioPlayed,h=Object(a.useState)(!1),g=Object(o.a)(h,2),j=g[0],m=g[1],f=Object(a.useState)(!1),b=Object(o.a)(f,2),p=b[0],O=b[1],v=Object(a.useState)(!1),I=Object(o.a)(v,2),x=I[0],E=I[1],C=Object(a.useState)(!1),S=Object(o.a)(C,2),y=S[0],Q=S[1],D=Object(a.useState)(!1),k=Object(o.a)(D,2),M=k[0],R=k[1],L=Object(a.useState)(0),N=Object(o.a)(L,2),_=N[0],U=N[1],H=Object(a.useState)("0%"),J=Object(o.a)(H,2),P=J[0],T=J[1],Y=Object(a.useState)(""),W=Object(o.a)(Y,2),F=W[0],G=W[1],q=Object(a.useRef)(""),z=Object(a.useRef)(new Audio(c)),X=Object(a.useRef)(),K=Object(a.useRef)("uploading"===c);function Z(){var e=0;isNaN(z.current.duration)||(e=z.current.currentTime*(100/z.current.duration),U(e),T(e+"%"),G(function(){var e=Math.floor(z.current.currentTime/60),t=Math.floor(z.current.currentTime-60*e);return t<10&&(t="0"+t),e<10&&(e="0"+e),e+":"+t}()))}return Object(a.useEffect)((function(){!0===K.current&&"uploading"!==c?(z.current=new Audio(c),z.current.load(),E(!0)):!1===K.current&&E(!0)}),[c]),Object(a.useEffect)((function(){var e;x&&(z.current.addEventListener("error",(function(){R(!0)})),(e=z.current,new Promise((function(t,n){e.onloadedmetadata=function(){e.currentTime=Number.MAX_SAFE_INTEGER,e.ontimeupdate=function(){e.ontimeupdate=function(){},e.currentTime=.1,e.currentTime=0,t(e.duration)}}}))).then((function(){Q(!0)})))}),[x]),Object(a.useEffect)((function(){y&&(z.current.addEventListener("canplaythrough",Object(u.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""===q.current&&(O(!0),t=Math.floor(z.current.duration/60),(n=Math.floor(z.current.duration-60*t))<10&&(n="0"+n),t<10&&(t="0"+t),q.current=t+":"+n,G(q.current));case 1:case"end":return e.stop()}}),e)})))),z.current.addEventListener("ended",(function(){clearInterval(X.current),G(q.current),U(0),T("0%"),m(!1)})))}),[y]),Object(a.useEffect)((function(){"exiting"===l&&z.current.pause()}),[l]),Object(a.useEffect)((function(){r!==s&&(z.current.pause(),m(!1))}),[r]),Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)("div",{className:"".concat(t?"audioplayer":"audioplayer audioplayer2"," ").concat(A?"audioplayer__played":""),children:[p||M?j&&!M?Object(B.jsx)(ze.a,{className:"pause",onClick:function(){z.current.pause(),clearInterval(X.current),m(!1),G(q.current)}}):j||M?Object(B.jsx)(Ke.a,{onClick:function(){z.current.load(),R(!1)}}):Object(B.jsx)(Ge.a,{onClick:function(){z.current.play(),A||t||ue.collection("rooms").doc(n).collection("messages").doc(s).set({audioPlayed:!0},{merge:!0}),r!==s&&i(s),X.current=setInterval(Z,50),m(!0)}}):Object(B.jsx)(w.a,{}),Object(B.jsxs)("div",{children:[Object(B.jsx)("span",{style:{width:P},className:"audioplayer__slider--played"}),Object(B.jsx)("input",{type:"range",min:"1",max:"100",value:_,onChange:function(e){var t=e.target.value;if(p){var n=z.current.duration*(t/100);z.current.currentTime=n,U(t),T("".concat(t-t/100*5.7,"%"))}},class:"audioplayer__slider"})]})]}),Object(B.jsx)("span",{className:"chat__timestamp audioplayer__time",children:F})]})}))),Ve=(n(144),n.p+"static/media/message_sent.3a970358.mp3"),$e=n.p+"static/media/message_received.644e27b6.mp3";function et(e){var t,n,c,s,i=e.animState,l=e.unreadMessages,h=e.b,g=Object(a.useState)(""),j=Object(o.a)(g,2),m=j[0],f=j[1],b=Object(le.i)().roomID,p=Object(le.h)(),O=Object(le.j)(),E=k(),C=Object(o.a)(E,3),S=C[0],y=S.dispatchMessages,Q=S.user,D=S.roomsData,M=S.page,R=C[1],N=C[2],_=Object(a.useState)({}),U=Object(o.a)(_,2),H=U[0],J=U[1],P=Object(a.useState)([]),T=Object(o.a)(P,2),Y=T[0],W=T[1],F=Object(a.useState)(null),G=Object(o.a)(F,2),q=G[0],z=G[1],X=Object(a.useState)(!1),K=Object(o.a)(X,2),Z=K[0],V=K[1],$=Object(a.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ne=ee[1],ce=Object(a.useState)(""),se=Object(o.a)(ce,2),de=se[0],Ae=se[1],he=Object(a.useState)(p.state?p.state:{}),ge=Object(o.a)(he,2),je=ge[0],me=ge[1],we=Object(a.useState)(!1),xe=Object(o.a)(we,2),Ce=xe[0],ye=xe[1],Qe=Object(a.useState)(!1),Re=Object(o.a)(Qe,2),Le=Re[0],Ne=Re[1],_e=Object(a.useState)(""),He=Object(o.a)(_e,2),Je=He[0],Te=He[1],Fe=Object(a.useState)(null),Ge=Object(o.a)(Fe,2),qe=Ge[0],ze=Ge[1],Xe=Object(a.useState)(0),Ke=Object(o.a)(Xe,2),et=Ke[0],tt=Ke[1],nt=Object(a.useState)(!1),at=Object(o.a)(nt,2),ct=at[0],st=at[1],it=Object(a.useState)(!1),rt=Object(o.a)(it,2),ot=rt[0],ut=rt[1],lt=Object(a.useState)(null),dt=Object(o.a)(lt,2),At=dt[0],ht=dt[1],gt=Object(a.useState)(!1),jt=Object(o.a)(gt,2),mt=jt[0],ft=jt[1],bt=Object(a.useState)(!1),pt=Object(o.a)(bt,2),Ot=pt[0],vt=pt[1],wt=Object(a.useState)(Boolean(null===(t=y[b])||void 0===t?void 0:t.limitReached)),It=Object(o.a)(wt,2),xt=It[0],Et=It[1],Ct=Object(le.g)(),St=Object(a.useRef)(),yt=Object(a.useRef)(),Bt=Object(a.useRef)(),Qt=Object(a.useRef)(),Dt=Object(a.useRef)(),kt=Object(a.useRef)([]),Mt=Object(a.useRef)(30),Rt=Object(a.useRef)(null),Lt=Object(a.useState)(null),Nt=Object(o.a)(Lt,2),_t=Nt[0],Ut=Nt[1],Ht=Object(a.useRef)(null),Jt=Object(a.useRef)(null),Pt=Object(a.useState)(!1),Tt=Object(o.a)(Pt,2),Yt=Tt[0],Wt=Tt[1],Ft=new Audio(Ve),Gt=new Audio($e),qt=Object(a.useRef)([]),zt=Object(a.useRef)(!1),Xt=function(){Dt.current.style.animation="opacity-out 300ms ease forwards",setTimeout((function(){ze(null),Te("")}),310)};function Kt(e){if(e){var t=e.offsetHeight,n=getComputedStyle(e);return t+=parseInt(n.marginTop)+parseInt(n.marginBottom)}return null}var Zt=function(){var e=Object(u.a)(d.a.mark((function e(t){var n,a,c,s,i,r,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),te&&document.querySelector(".chat__footer > form > input").focus(),!(""!==m||""===m&&qe)){e.next=18;break}return n=m,(a=qe)&&Xt(),f(""),c={lastMessage:a?{message:n,audio:!1}:n,seen:!1},ue.collection("rooms").doc(b).set(c,{merge:!0}),a&&(s=a.name.split("."),i=s[0]+Object(Ue.a)()+"."+s[1]),r=a?{name:Q.displayName,message:m,uid:Q.uid,timestamp:ae(),time:(new Date).toUTCString(),imageUrl:"uploading",imageName:i,ratio:ct}:{name:Q.displayName,message:m,uid:Q.uid,timestamp:ae(),time:(new Date).toUTCString()},je.userID?(ue.collection("users").doc(je.userID).collection("chats").doc(b).set({timestamp:ae(),photoURL:Q.photoURL?Q.photoURL:null,name:Q.displayName,userID:Q.uid,unreadMessages:ie(1)},{merge:!0}),ue.collection("users").doc(Q.uid).collection("chats").doc(b).set({timestamp:ae(),photoURL:je.photoURL?je.photoURL:null,name:je.name,userID:je.userID},{merge:!0}),""===de||a||ue.collection("notifications").add({userID:Q.uid,title:Q.displayName,body:n,photoURL:Q.photoURL,token:de})):ue.collection("users").doc(Q.uid).collection("chats").doc(b).set({timestamp:ae(),photoURL:je.photoURL?je.photoURL:null,name:je.name}),e.next=15,ue.collection("rooms").doc(b).collection("messages").add(r);case 15:o=e.sent,a&&new Ye.a(a,{quality:.8,maxWidth:1920,success:function(e){return Object(u.a)(d.a.mark((function t(){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te(""),ze(null),t.next=4,re.child(i).put(e);case 4:return t.next=6,re.child(i).getDownloadURL();case 6:a=t.sent,ue.collection("rooms").doc(b).collection("messages").doc(o.id).update({imageUrl:a}),je.userID&&""!==de&&ue.collection("notifications").add({userID:Q.uid,title:Q.displayName,body:n,photoURL:Q.photoURL,token:de,image:a});case 9:case"end":return t.stop()}}),t)})))()}});case 18:case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Vt=function(){var e=Object(u.a)(d.a.mark((function e(){var t,n,a,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.navigator.onLine){e.next=26;break}return z(!1),V(!0),e.prev=3,t=ue.collection("rooms").doc(b),e.next=7,t.collection("messages").get();case 7:return n=e.sent,a=[],c=[],n.docs.forEach((function(e){e.data().audioName?a.push(e.data().audioName):e.data().imageName&&c.push(e.data().imageName)})),s=[],s=je.userID?[je.userID,Q.uid]:Object(I.a)(new Set(n.docs.map((function(e){return e.data().uid})))),e.next=16,Promise.all([].concat(Object(I.a)(n.docs.map((function(e){return e.ref.delete()}))),Object(I.a)(c.map((function(e){return re.child(e).delete()}))),Object(I.a)(a.map((function(e){return oe.child(e).delete()}))),Object(I.a)(s.map((function(e){return ue.collection("users").doc(e).collection("chats").doc(b).delete()}))),[t.delete()]));case 16:M.width<=760?Ct.goBack():Ct.replace("/chats"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(3),console.log(e.t0.message),M.width<=760?Ct.goBack():Ct.replace("/chats");case 23:e.next=27;break;case 26:alert("No access to internet !!!");case 27:case 28:case"end":return e.stop()}}),e,null,[[3,19]])})));return function(){return e.apply(this,arguments)}}();function $t(e){var t=ue.collection("rooms").doc(b).collection("messages").orderBy("timestamp","desc");e?h.current[b]=t.limit(5).onSnapshot((function(t){var n=t.docs.map((function(e){var t,n=e.data(),a=n.time?n.time:new Date(null===(t=n.timestamp)||void 0===t?void 0:t.toDate()).toUTCString();return Object(r.a)(Object(r.a)({},n),{},{timestamp:a,id:e.id})}));n.reverse(),R({type:N.SET_MESSAGES,id:b,messages:n,update:e})})):t.limit(Mt.current).get().then((function(t){var n=[];t.forEach((function(e){var t,a=e.data(),c=a.time?a.time:new Date(null===(t=a.timestamp)||void 0===t?void 0:t.toDate()).toUTCString();n.push(Object(r.a)(Object(r.a)({},a),{},{timestamp:c,id:e.id}))})),n.reverse(),R({type:N.SET_MESSAGES,id:b,messages:n,update:e})}))}function en(){var e;0!==(null===(e=Bt.current)||void 0===e?void 0:e.scrollTop)||xt||Ht.current?Jt.current&&(Rt.current=Bt.current.scrollHeight-Bt.current.scrollTop):(Wt(!0),Rt.current=Bt.current.scrollHeight,Ht.current=!0,Jt.current=!0,Mt.current=Y.length+Mt.current,$t(!1))}function tn(e){return ue.collection("rooms").doc(b).collection("messages").doc(e).onSnapshot((function(t){var n=t.data().imageUrl;"uploading"!==n&&(R({type:"update_media",roomID:b,id:e,data:{imageUrl:n}}),qt.current=qt.current.filter((function(t){return t.id!==e||(t.snap(),!1)})))}))}function nn(e){return ue.collection("rooms").doc(b).collection("messages").doc(e).onSnapshot((function(t){var n=t.data(),a=n.audioUrl,c=n.audioPlayed;"uploading"===a&&!0!==c||R({type:"update_media",roomID:b,id:e,data:{audioUrl:a,audioPlayed:c}}),"uploading"!==a&&!0===c&&(qt.current=qt.current.filter((function(t){return t.id!==e||(t.snap(),!1)})))}))}Object(a.useEffect)((function(){var e,t,n;Y.length>0&&!Z&&(Y[Y.length-1].id!==(null===(e=kt.current[(null===(t=kt.current)||void 0===t?void 0:t.length)-1])||void 0===e?void 0:e.id)&&null!==(n=y[b])&&void 0!==n&&n.audio&&(Y[Y.length-1].uid===Q.uid||Jt.current||"uploading"!==Y[Y.length-1].imageUrl&&Y[Y.length-1].imageUrl?Y[Y.length-1].uid!==Q.uid||Jt.current||"uploading"!==Y[Y.length-1].imageUrl&&Y[Y.length-1].imageUrl||"uploading"!==Y[Y.length-1].audioUrl&&Y[Y.length-1].audioUrl||Ft.play():Gt.play()))}),[Y,Z,y[b]]),Object(a.useEffect)((function(){mt&&!xt&&Bt.current.addEventListener("scroll",en);var e=Bt.current;return function(){e.removeEventListener("scroll",en)}}),[mt,xt]),Object(a.useEffect)((function(){var e,t;xt!==(null===(e=y[b])||void 0===e?void 0:e.limitReached)&&Et(Boolean(null===(t=y[b])||void 0===t?void 0:t.limitReached))}),[y[b]],xt),Object(a.useLayoutEffect)((function(){var e;Y.length>0&&Ht.current&&(Ht.current&&Y.length>(null===(e=kt.current)||void 0===e?void 0:e.length)&&(Bt.current.scrollTop=Bt.current.scrollHeight-Rt.current,Ht.current=!1,Wt(!1)))}),[Y]),Object(a.useEffect)((function(){Y.length>0&&(mt||Bt.current.scrollHeight-Bt.current.offsetHeight===0?Jt.current||function(){var e=Array.from(document.querySelectorAll(".chat__message")),t=Kt(e[e.length-2])+Kt(e[e.length-3])+Kt(e[e.length-4]),n=t<M.height/2?t:M.height/2;Bt.current.scrollHeight-Bt.current.offsetHeight===0?(setTimeout((function(){St.current&&(St.current.style.opacity="1"),ft(!0)}),"entering"===i?350:50),setTimeout((function(){var e=document.querySelector(".chat .chat__lastMessage");e&&(e.style.animation="none",e.style.opacity="1")}),50)):Bt.current.scrollTop+Kt(e[e.length-1])>=Bt.current.scrollHeight-Bt.current.offsetHeight-n&&Y[Y.length-1].uid!==Q.uid||Y[Y.length-1].uid===Q.uid?Bt.current.scrollTop!==Bt.current.scrollHeight&&(vt(!0),Object(We.a)({targets:Bt.current,scrollTop:Bt.current.scrollHeight,duration:800,easing:"linear",complete:function(){vt(!1)}})):ut(!0)}():(Bt.current.scrollTop=Bt.current.scrollHeight,setTimeout((function(){var e=document.querySelector(".chat .chat__lastMessage");e&&(e.style.animation="none",e.style.opacity="1"),setTimeout((function(){ft(!0)}),200)}),50)))}),[Y]),Object(a.useEffect)((function(){return function(){R({type:"set_audio_false",id:b})}}),[b]),Object(a.useEffect)((function(){if(Y.length>0&&mt&&!zt.current)Y.forEach((function(e){if("uploading"===e.imageUrl){var t=tn(e.id);qt.current.push({snap:t,id:e.id})}else if("uploading"===e.audioUrl||!1===e.audioPlayed){var n=nn(e.id);qt.current.push({snap:n,id:e.id})}})),zt.current=!0;else if(Y.length>kt.current.length&&mt&&zt.current){var e,t=0,n=Y.length-kt.length;(null===(e=kt.current[0])||void 0===e?void 0:e.id)===Y[0].id&&(t=kt.current.length,n=Y.length);for(var a=t;a<n;a++)if("uploading"===Y[a].imageUrl){var c=tn(Y[a].id);qt.current.push({snap:c,id:Y[a].id})}else if("uploading"===Y[a].audioUrl||!1===Y[a].audioPlayed){var s=nn(Y[a].id);qt.current.push({snap:s,id:Y[a].id})}}}),[Y,mt]),Object(a.useEffect)((function(){return function(){qt.current.forEach((function(e){return e.snap()})),ft(!1)}}),[b]),Object(a.useEffect)((function(){Jt.current=Ht.current,kt.current=Object(I.a)(Y)}),[Y]),Object(a.useEffect)((function(){var e;b&&!Z&&(h.current[b]&&h.current[b](),null!==(e=y[b])&&void 0!==e&&e.firstMessageID?$t(!0):ue.collection("rooms").doc(b).collection("messages").orderBy("timestamp","asc").limit(1).get().then((function(e){e.empty?R({type:"set_firstMessage",id:b,firstMessageID:"no id"}):e.forEach((function(e){R({type:"set_firstMessage",id:b,firstMessageID:e.id})})),$t(!1),$t(!0)})))}),[b,Z]),Object(a.useEffect)((function(){if(""!==Je){var e=document.querySelector(".mediaPreview img").clientWidth,t=document.querySelector(".mediaPreview img").clientHeight;st(t/e)}}),[Je]),Object(a.useEffect)((function(){ht(document.querySelector(".chat__body--container").clientWidth)}),[]),Object(a.useEffect)((function(){"entering"===i&&M.width<=760?setTimeout((function(){document.querySelector(".chat").classList.add("chat-animate")}),0):"entered"===i&&null!==je&&void 0!==je&&je.name&&M.width<=760?setTimeout((function(){document.querySelector(".sidebar").classList.remove("side")}),50):"exiting"===i&&M.width<=760&&setTimeout((function(){document.querySelector(".chat").classList.remove("chat-animate"),setTimeout((function(){document.querySelector(".sidebar").classList.add("side")}),10)}),0)}),[i]),Object(a.useEffect)((function(){if(!p.state&&b){var e=null===b||void 0===b?void 0:b.replace(Q.uid,"");ue.collection("users").doc(e).get().then((function(t){var n=t.data();me(null!==n&&void 0!==n&&n.name?{name:n.name,photoURL:n.photoURL,userID:e}:{userID:e})}))}else me(p.state)}),[p.state,b]),Object(a.useEffect)((function(){null!==je&&void 0!==je&&je.userID&&ue.collection("users").doc(je.userID).onSnapshot((function(e){var t;null!==(t=e.data())&&void 0!==t&&t.token&&Ae(e.data().token)}))}),[je]),Object(a.useEffect)((function(){if(b&&null!==je&&void 0!==je&&je.userID)var e=ue.collection("rooms").doc(b).onSnapshot((function(e){e.data()&&Ne(e.data()[je.userID])}));return function(){e&&e()}}),[b,je]),Object(a.useEffect)((function(){if(b)var e=ue.collection("rooms").doc(b).onSnapshot((function(e){var t;ye(null===(t=e.data())||void 0===t?void 0:t.seen)}));return function(){e&&e()}}),[b]),Object(a.useEffect)((function(){var e=function(){var e,t,n,a=Array.from(document.querySelectorAll(".chat__message")),c=Kt(a[a.length-1])+Kt(a[a.length-2])+Kt(a[a.length-3])+Kt(a[a.length-4]),s=c<M.height/2?c:M.height/2;(null===(e=Bt.current)||void 0===e?void 0:e.scrollTop)<=(null===(t=Bt.current)||void 0===t?void 0:t.scrollHeight)-(null===(n=Bt.current)||void 0===n?void 0:n.offsetHeight)-s?ut(!0):ut(!1);var r=Math.round(Bt.current.scrollTop),o=Bt.current.scrollHeight-Bt.current.offsetHeight;r!==o&&r+1!==o&&r-1!==o||"0"!==St.current.style.opacity&&""!==St.current.style.opacity||setTimeout((function(){St.current&&(St.current.style.opacity="1")}),"entering"===i?350:50),Y.length>0&&(Bt.current.scrollTop>Bt.current.scrollHeight-Bt.current.offsetHeight-180&&je.userID&&!Ce&&Y[Y.length-1].uid!==Q.uid&&(console.log("setting seen true with event"),ue.collection("rooms").doc(b).set({seen:!0},{merge:!0})),Bt.current.scrollTop>Bt.current.scrollHeight-Bt.current.offsetHeight-180&&je.userID&&ue.collection("users").doc(Q.uid).collection("chats").doc(b).set({unreadMessages:0},{merge:!0}))};Bt.current.addEventListener("scroll",e);var t=Bt.current;return function(){t.removeEventListener("scroll",e)}}),[Y,je,Q.uid,b,Ce]),Object(a.useEffect)((function(){Y.length>0&&Bt.current.scrollHeight-Bt.current.offsetHeight===0&&Y[Y.length-1].uid!==Q.uid&&ue.collection("rooms").doc(b).set({seen:!0},{merge:!0})}),[Y]),Object(a.useEffect)((function(){Y.length>0&&Bt.current.scrollHeight-Bt.current.offsetHeight===0&&je.userID&&ue.collection("users").doc(Q.uid).collection("chats").doc(b).set({unreadMessages:0},{merge:!0})}),[Y,je]),Object(a.useEffect)((function(){var e;null!==(e=y[b])&&void 0!==e&&e.messages&&W(y[b].messages)}),[y[b]]);var an=.7;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)("div",{style:b?{}:{display:"none"},ref:Qt,className:"chat",children:[Object(B.jsx)("div",{style:{height:M.height},className:"chat__background"}),Object(B.jsxs)("div",{className:"chat__header",children:[M.width<=760?Object(B.jsxs)(L.a,{onClick:function(){return setTimeout((function(){return Ct.goBack()}),150)},children:[Object(B.jsx)(De.a,{}),Object(B.jsxs)("div",{className:"avatar__container",children:[Object(B.jsx)(A.a,{src:null===je||void 0===je?void 0:je.photoURL}),"online"===(null===(n=D[b])||void 0===n?void 0:n.onlineState)?Object(B.jsx)("div",{className:"online"}):null]})]}):Object(B.jsxs)("div",{className:"avatar__container",children:[Object(B.jsx)(A.a,{src:null===je||void 0===je?void 0:je.photoURL}),"online"===(null===(c=D[b])||void 0===c?void 0:c.onlineState)?Object(B.jsx)("div",{className:"online"}):null]}),Object(B.jsxs)("div",{className:"chat__header--info",children:[Object(B.jsxs)("h3",{style:M.width<=760?{width:M.width-165}:{},children:[null===je||void 0===je?void 0:je.name," "]}),Object(B.jsxs)("p",{style:M.width<=760?{width:M.width-165}:{},children:["recording"===Le?"Recording ...":Le?"Typing ...":(null===Y||void 0===Y?void 0:Y.length)>0?"Seen at "+(null===(s=Y[Y.length-1])||void 0===s?void 0:s.timestamp):""," "]})]}),Object(B.jsxs)("div",{className:"chat__header--right",children:[Object(B.jsx)("input",{id:"attach-media",style:{display:"none"},accept:"image/*",type:"file",onChange:function(e){if(window.navigator.onLine){if(e.target.files[0]){var t=new FileReader;t.onload=function(){Te(t.result)},t.readAsDataURL(e.target.files[0]),ze(e.target.files[0])}}else alert("No access to internet !!!")}}),Object(B.jsx)(L.a,{children:Object(B.jsx)("label",{style:{cursor:"pointer",height:24},htmlFor:"attach-media",children:Object(B.jsx)(Ie.a,{})})}),Object(B.jsx)(L.a,{"aria-controls":"menu","aria-haspopup":"true",onClick:function(e){return z(e.currentTarget)},children:Object(B.jsx)(Ee.a,{})}),Object(B.jsx)(fe.a,{anchorEl:q,id:"menu",open:Boolean(q),onClose:function(){return z(null)},keepMounted:!0,children:Object(B.jsx)(be.a,{onClick:Vt,children:"Delete Room"})})]})]}),Object(B.jsx)("div",{className:"chat__body--container",ref:Bt,children:Object(B.jsxs)("div",{className:"chat__body",ref:St,children:[Object(B.jsx)("div",{className:"loader__container paginateLoader",style:{height:xt?30:70},children:Yt&&!xt?Object(B.jsx)(w.a,{}):null}),Y.map((function(e,t,n){var a=(e.imageUrl,{marginBottom:n[t+1]?e.uid!==n[t+1].uid?30:8:0,width:At*an+20,maxWidth:320});return Object(B.jsxs)("div",{style:a,ref:t!==Y.length-1||Ce&&Y[Y.length-1].uid===Q.uid?null:yt,className:"chat__message ".concat(e.uid===Q.uid&&"chat__reciever"," ").concat(t===Y.length-1?"chat__lastMessage":""),children:[Object(B.jsx)("span",{className:"chat__name",children:e.name}),"uploading"===e.imageUrl?Object(B.jsx)("div",{style:{width:At*an,height:e.ratio<=1?At*an>300?300*e.ratio:At*an*e.ratio:At*an<300?At*an:300},className:"image-container",children:Object(B.jsx)("div",{className:"image__container--loader",children:Object(B.jsx)(w.a,{style:{width:M.width<=760?40:80,height:M.width<=760?40:80}})})}):e.imageUrl?Object(B.jsx)("div",{className:"image-container",style:{width:At*an,height:e.ratio<=1?At*an>300?300*e.ratio:At*an*e.ratio:At*an<300?At*an:300},children:Object(B.jsx)(v.b,{to:{pathname:O.url+"/image",state:je},children:Object(B.jsx)("img",{onClick:function(t){return function(e,t,n){var a=e.target,c=a.parentNode.parentNode,s=c.getBoundingClientRect();J({ratio:n,top:"scale(1)"===M.transform?s.top:s.top/(window.innerHeight/M.height),left:"scale(1)"===M.transform?s.left:s.left/(window.innerWidth/M.width),width:c.offsetWidth,height:c.offsetHeight,imgW:a.offsetWidth,imgH:a.offsetHeight,src:t})}(t,e.imageUrl,e.ratio)},src:e.imageUrl,alt:""})})}):null,e.audioName?Object(B.jsx)(Ze,{sender:e.uid===Q.uid,roomID:b,animState:i,setAudioID:Ut,audioID:_t,id:e.id,audioUrl:e.audioUrl,audioPlayed:e.audioPlayed}):Object(B.jsx)("span",{className:"chat__message--message",children:e.message}),Object(B.jsx)("span",{className:"chat__timestamp",children:e.timestamp})]},e.id)})),Y.length>0?Object(B.jsx)(pe.a,{in:Ce&&Y[Y.length-1].uid===Q.uid,timeout:200,classNames:"seen-animate",appear:!0,children:Object(B.jsx)("p",{className:"seen",children:Object(B.jsx)("p",{children:Object(B.jsxs)("span",{children:["Seen ",Object(B.jsx)(Se.a,{})]})})})}):null]})}),""!==Je?Object(B.jsx)(ke,{close:Xt,mediaPreview:Dt,setSRC:Te,setImage:ze,imageSRC:Je}):null,Object(B.jsx)(Pe,{input:m,handleFocus:function(){Bt.current.scrollTop>Bt.current.scrollHeight-Bt.current.offsetHeight-120&&(Bt.current.scrollTop=Bt.current.scrollHeight)},change:function(e){clearTimeout(et),f(e.target.value),null!==je&&void 0!==je&&je.userID&&ue.collection("rooms").doc(b).set(Object(x.a)({},Q.uid,!0),{merge:!0}).then((function(){tt(setTimeout((function(){ue.collection("rooms").doc(b).set(Object(x.a)({},Q.uid,!1),{merge:!0})}),1e3))}))},sendMessage:Zt,setFocus:ne,image:qe,focus:te,state:je,token:de,roomID:b,setAudioID:Ut}),Object(B.jsx)("div",{}),Object(B.jsx)(pe.a,{in:mt&&ot&&!Ot,classNames:"scroll",timeout:310,unmountOnExit:!0,children:Object(B.jsxs)("div",{className:"scroll",onClick:function(){return Object(We.a)({targets:Bt.current,scrollTop:Bt.current.scrollHeight,duration:1e3,easing:"linear"})},children:[Object(B.jsx)(Be.a,{style:{width:22,height:22,color:"black"}}),l?Object(B.jsx)("div",{children:Object(B.jsx)("span",{children:l})}):null]})}),Z?Object(B.jsx)("div",{className:"chat__deleting",children:Object(B.jsx)(w.a,{})}):null]}),Object(B.jsx)(Oe.a,{component:null,children:Object(B.jsx)(ve.a,{timeout:{appear:310,enter:310,exit:410},classNames:"page",children:function(e){return Object(B.jsx)(le.b,{path:O.url+"/image",location:p,children:Object(B.jsx)(Me,{imagePreview:H,animState:e})})}},p.pathname)})]})}var tt=Object(a.memo)(et),nt=n(193),at=n.p+"static/media/logo.e70cae76.png",ct=n.p+"static/media/google.0358fb9c.png";n(146);function st(){return Object(B.jsx)("div",{className:"login",children:Object(B.jsxs)("div",{className:"login__container",children:[Object(B.jsx)("img",{src:at,alt:"FredChat logo"}),Object(B.jsx)("div",{className:"login__text",children:Object(B.jsxs)("h1",{children:["Join ",Object(B.jsx)("span",{className:"app_name",children:"FredChat"})]})}),Object(B.jsxs)(nt.a,{onClick:function(){ee.signInWithRedirect(te).catch((function(e){return alert(e.message)}))},className:"btn",children:[Object(B.jsx)("span",{className:"sign_in",children:"Sign in with"})," ",Object(B.jsx)("img",{src:ct,height:"20",width:"20",alt:"google"})]}),Object(B.jsxs)(nt.a,{onClick:function(){ee.signInWithRedirect(ne).catch((function(e){return alert(e.message)}))},className:"btn",children:[Object(B.jsx)("span",{className:"sign_in",children:"Sign in with"})," ",Object(B.jsx)("img",{src:"data:image/png;base64,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rAYBADAengHApgkAgLGovgOAzRMAACNROt8CyOYJAICR6H0NMDMQAAAjUYqnALJ5AgBgJLqpewDYPAEAMBIb/eRk6w2sDgEAMA5nnzzxs8+1HsHqEAAA4+AZAMxEAACMg08AMBMBADAKbgBkNgIAYARKeAYAsxEAACPQOwFgRgIAYAS6IgCYjQAAGIELa+dPtt7AahEAAKvv7H/99N99tvUIVosAAFhxJXwHALMTAAArzrcAMg8BALDiik8AMAcBALDyihMAZiYAAFZcjf5k6w2sHgEAsOLcBMg8BADAitvmIUDMQQAArLZzj37m/mdaj2D1CACA1Xay9QBWkwAAWGGu/zMvAQCwwmoRAMxHAACsshqeAcBcBADACitOAJiTAABYYf3URwCZjwAAWGGTfu1k6w2sJgEAsLrOffHE3adaj2A1ldYDYBXtPXj0NyPK4dY7Mqi1/PMnHrnvH7TeAWPjBAAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJPS/Ab6MFC7ZR4dJAAAAAElFTkSuQmCC",height:"20",width:"20",alt:"google"})]})]})})}var it=Object(a.memo)(st);n(147);function rt(){return Object(B.jsxs)("div",{children:[Object(B.jsx)("div",{className:"spinner",children:Object(B.jsx)("div",{className:"container",children:Object(B.jsx)("div",{className:"loader"})})}),Object(B.jsxs)("p",{className:"logo",children:[Object(B.jsx)("img",{src:at,alt:"logo",height:"30",width:"30"}),Object(B.jsx)("span",{children:"Loading..."})]})]})}n(148);function ot(e,t,n,c,s){var i=Object(a.useRef)(0),r=Object(a.useRef)(),u=Object(a.useState)(null),l=Object(o.a)(u,2),d=l[0],A=l[1],h=Object(a.useRef)(0);return[d,function a(o){if(i.current||0===i.current){"limit attended"===i.current?(o(!1),i.current=null):(o(!0),i.current=i.current+e),r.current&&r.current(),n&&(h.current=0);var u=null,l=i.current?t.limit(i.current):t;r.current=l.onSnapshot((function(e){var t,n;h.current++;var r=function(){var t=c(e);A(t),o(!1),("users"===s&&t.length<i.current-1||"users"!==s&&t.length<i.current)&&(i.current="limit attended",a(o))};(null===(t=e.docs)||void 0===t?void 0:t.length)>0?h.current>=2?(u&&(clearTimeout(u),u=null),r()):u=setTimeout(r,1500):0===(null===(n=e.docs)||void 0===n?void 0:n.length)&&(A([]),o(!1))}))}return r},A]}function ut(){var e=k(),t=Object(o.a)(e,3),n=t[0],c=n.user,s=n.path,i=n.pathID,u=n.roomsData,l=n.page,d=t[1],A=t[2],h=Object(a.useState)(!0),g=Object(o.a)(h,2),j=g[0],m=g[1],f=Object(a.useState)(void 0),b=Object(o.a)(f,2),p=b[0],O=b[1],v=Object(a.useState)(!1),w=Object(o.a)(v,2),I=w[0],x=w[1],C=Object(a.useState)(!0),S=Object(o.a)(C,2),y=S[0],Q=S[1],D=Object(a.useState)(null),M=Object(o.a)(D,2),R=M[0],L=M[1],N=Object(a.useState)(),_=Object(o.a)(N,2),U=_[0],H=_[1],J=Object(le.h)(),P=function(){var e=k(),t=Object(o.a)(e,2),n=t[0].roomsData,c=t[1],s=Object(a.useRef)(n);return Object(a.useEffect)((function(){s.current=n}),[n]),[function(e,t){if(!s.current[t]){var n=ue.collection("rooms").doc(t).onSnapshot((function(e){var n;c({type:"update_rooms_data",dataType:"lastMessage",data:null===(n=e.data())||void 0===n?void 0:n.lastMessage,roomID:t})})),a=ue.collection("users").doc(e).onSnapshot((function(e){var n;c({type:"update_rooms_data",dataType:"onlineState",data:null===(n=e.data())||void 0===n?void 0:n.state,roomID:t})}));c({type:"add_rooms_data",roomID:t,lastMessageListener:n,onlineStatelistener:a})}}]}(),T=Object(o.a)(P,1)[0],Y=Object(a.useRef)([]),W=["/rooms","/search","/users","/chats"],F=ot(30,ue.collection("rooms").orderBy("timestamp","desc"),!0,(function(e){return e.docs.map((function(e){return Object(r.a)({id:e.id},e.data())}))}),"rooms"),G=Object(o.a)(F,2),q=G[0],z=G[1],X=ot(30,ue.collection("users").orderBy("timestamp","desc"),!0,(function(e){var t=[];return e.docs.length>0&&e.docs.forEach((function(e){var n=e.id>c.uid?e.id+c.uid:c.uid+e.id;e.id!==c.uid&&(t.push(Object(r.a)(Object(r.a)({},e.data()),{},{id:n,userID:e.id})),T(e.id,n))})),t}),"users"),K=Object(o.a)(X,2),Z=K[0],V=K[1];return Object(a.useEffect)((function(){ee.onAuthStateChanged((function(e){if(e){d({type:A.SET_USER,user:e}),m(!1),"serviceWorker"in navigator&&"PushManager"in window&&(n=e.uid,se.requestPermission().then((function(){return se.getToken()})).then((function(e){ue.collection("users").doc(n).set({token:e},{merge:!0})})).catch((function(e){ue.collection("users").doc(n).set({token:""},{merge:!0})}))),ue.collection("version").doc("version").get().then((function(e){var t=e.data().version,n=localStorage.getItem("version");n?t!==+n?(localStorage.setItem("version",t),x(!0),ee.signOut(),ee.signInWithRedirect(te).catch((function(e){return alert(e.message)}))):Q(!1):(localStorage.setItem("version",t),Q(!1))}));var t=ue.collection("users").doc(e.uid);t.get().then((function(n){var a=n.data();return a&&a.timestamp?t.set({name:e.displayName,photoURL:e.photoURL},{merge:!0}):t.set({name:e.displayName,photoURL:e.photoURL,timestamp:ae()},{merge:!0})}))}else d({type:A.SET_USER,user:null}),m(!1),ue.collection("version").doc("version").get().then((function(e){var t=e.data().version,n=localStorage.getItem("version");n?t!==+n?(localStorage.setItem("version",t),Q(!1)):Q(!1):(localStorage.setItem("version",t),Q(!1))}));var n}))}),[]),Object(a.useEffect)((function(){window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault(),O(e)})),window.addEventListener("resize",(function(){d({type:"set_scale_page",page:E()})}))}),[]),Object(a.useEffect)((function(){c&&(ue.collection("users").doc(c.uid).collection("chats").orderBy("timestamp","desc").onSnapshot({includeMetadataChanges:!0},(function(e){var t;(null===(t=e.docs)||void 0===t?void 0:t.length)>0?(e.docChanges().forEach((function(e){"added"===e.type&&T(e.doc.data().userID,e.doc.id)})),(!e.metadata.fromCache||!window.navigator.onLine&&e.metadata.fromCache)&&L(e.docs.map((function(e){return Object(r.a)(Object(r.a)({},e.data()),{},{id:e.id})})))):L([])})),z((function(){return null})),V((function(){return null})))}),[c]),Object(a.useEffect)((function(){(null===R||void 0===R?void 0:R.length)>0?R.every((function(e){var t;return null===(t=u[e.id])||void 0===t?void 0:t.lastMessage}))&&H(!0):0===(null===R||void 0===R?void 0:R.length)&&H(!0)}),[R,u]),Object(a.useEffect)((function(){var e;return c&&function(e){try{var t={state:"offline",last_changed:ce,id:e},n={state:"online",last_changed:ce,id:e},a=ue.doc("/users/"+e),c=$.ref("/status/"+e),s={state:"offline",last_changed:ae()},i={state:"online",last_changed:ae()};$.ref(".info/connected").on("value",(function(e){!1!==e.val()?c.onDisconnect().set(t).then((function(){c.set(n),a.set(i,{merge:!0})})):a.set(s,{merge:!0})}))}catch(r){console.log("error setting onlins status: ",r)}}(c.uid),function(){e}}),[c]),Object(a.useEffect)((function(){var e=J.pathname.replace("/room/","");W.forEach((function(t){return e=e.replace(t,"")})),d({type:"set_path_id",id:e})}),[J.pathname]),Object(B.jsxs)("div",{className:"app",style:Object(r.a)({},l),children:[l.width<=760?Object(B.jsx)(le.a,{to:"/chats"}):Object(B.jsx)(le.a,{to:"/"}),c||j||y||I?c&&!I&&U?Object(B.jsxs)("div",{className:"app__body",children:[Object(B.jsx)(me,{chats:R,pwa:p,rooms:q,fetchRooms:z,users:Z,fetchUsers:V}),Object(B.jsx)(Oe.a,{component:null,children:l.width<=760?Object(B.jsx)(ve.a,{timeout:260,children:function(e){var t;return Object(B.jsx)(le.b,{location:J,path:"".concat(s,"/room/:roomID"),children:Object(B.jsx)(tt,{b:Y,unreadMessages:(null===R||void 0===R?void 0:R.length)>0?null===(t=R.find((function(e){return e.id===i})))||void 0===t?void 0:t.unreadMessages:0,animState:e})})}},J.pathname.replace("/image","")):Object(B.jsx)(pe.a,{timeout:1010,classNames:"page",children:function(e){var t;return Object(B.jsx)(le.b,{location:J,path:"".concat(s,"/room/:roomID"),children:Object(B.jsx)(tt,{b:Y,unreadMessages:(null===R||void 0===R?void 0:R.length)>0?null===(t=R.find((function(e){return e.id===i})))||void 0===t?void 0:t.unreadMessages:0,animState:e})})}},J.pathname.replace("/image",""))})]}):Object(B.jsx)("div",{className:"loader__container",children:Object(B.jsx)(rt,{})}):Object(B.jsx)(it,{})]})}var lt=Object(a.memo)(ut),dt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function At(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(n,a){t.call(navigator,e,n,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),i.a.render(Object(B.jsx)(c.a.StrictMode,{children:Object(B.jsx)(v.a,{children:Object(B.jsx)(D,{initialState:C,reducer:y,children:Object(B.jsx)(lt,{})})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");dt?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):At(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):At(t,e)}))}}()}},[[149,1,2]]]);
//# sourceMappingURL=main.a38b6214.chunk.js.map