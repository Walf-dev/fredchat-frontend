{"version":3,"sources":["components/scalePage.js","states/reducer.js","states/StateProvider.js","components/SidebarChat.js","firebase/firebase.js","sounds/notification.mp3","components/Sidebar.js","components/MediaPreview.js","components/ImagePreview.js","components/recorder.js","components/ChatFooter.js","components/AudioPlayer.js","sounds/message_sent.mp3","sounds/message_received.mp3","components/Chat.js","images/logo.png","images/google.png","components/Login.js","images/facebook.png","loaders/CircularProgress.js","hooks/useFetchData.js","components/App.js","hooks/useRoomsData.js","components/setOnlineStatus.js","serviceWorkerRegistration.js","index.js"],"names":["scalePage","window","innerHeight","innerWidth","currentRatio","ratio","width","height","transform","initialState","user","path","pathID","dispatchMessages","audioID","roomsData","page","actionTypes","SET_USER","SET_MESSAGES","reducer","state","action","type","id","update","messages","length","limitReached","firstMessageID","audio","undefined","arr","s","isSame","i","slice","newMessages","f","updatedMessages","roomID","e","findIndex","cur","data","newRoomsData","lastMessageListener","onlineStatelistener","dataType","StateContext","createContext","StateProvider","children","Provider","value","useReducer","useStateValue","useContext","SidebarChat","dataList","title","fetchList","dispatch","useState","scrollFetch","setScrollFetch","list","setList","sidebarChatContainer","useRef","useEffect","a","parseInt","current","scrollTop","scrollHeight","offsetHeight","addEventListener","clean","removeEventListener","setTimeout","Array","from","document","querySelectorAll","forEach","classList","remove","onlineState","lastMessage","push","className","to","pathname","photoURL","name","userID","Avatar","style","src","dangerouslySetInnerHTML","__html","_highlightResult","marginBottom","message","time","unreadMessages","ref","CircularProgress","memo","firebaseApp","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","db","firestore","enablePersistence","db2","database","auth","provider","GoogleAuthProvider","provider2","FacebookAuthProvider","createTimestamp","FieldValue","serverTimestamp","createTimestamp2","ServerValue","TIMESTAMP","messaging","navigator","fieldIncrement","increment","storage","arrayUnion","audioStorage","index","algoliasearch","initIndex","Sidebar","Nav","chats","pwa","rooms","fetchRooms","users","fetchUsers","searchList","setSearchList","searchInput","setSearchInput","menu","setMenu","mounted","setMounted","history","useHistory","notification","Audio","prevUnreadMessages","querySelector","blur","preventDefault","search","result","hits","map","objectID","uid","props","classSelected","onClick","click","NavLink","play","add","minHeight","displayName","IconButton","console","log","prompt","signOut","doc","set","merge","replace","onChange","target","placeholder","display","activeClassName","roomName","collection","timestamp","imageSRC","mediaPreview","close","setHeight","alt","imagePreview","animState","loaded","setLoaded","animW","animH","el","imageRatio","imgH","imgW","backgroundColor","borderRadius","transformOrigin","left","top","imgStyle","minWidth","createPortal","toggle","goBack","onLoad","record","Promise","resolve","mediaDevices","getUserMedia","then","stream","mediaRecorder","MediaRecorder","audioChunks","event","start","stop","audioName","uuidv4","audioFile","File","audioUrl","URL","createObjectURL","wait","input","handleFocus","change","sendMessage","setFocus","image","focus","token","setAudioID","recording","setRecording","recordingTimer","setRecordingTimer","recordingEl","inputRef","timerInterval","sendAudio","timer","seen","Date","toUTCString","audioPlayed","child","put","getDownloadURL","url","body","onLine","recorder","alert","stopRecording","clearInterval","stopped","opacity","pad","val","valString","now","setInterval","delta","totalSeconds","Math","floor","btnIcons","CSSTransition","in","timeout","enter","exit","classNames","color","onBlur","currentTarget","contains","relatedTarget","onKeyPress","onFocus","class","for","accept","capture","file","files","duration","sender","isPlaying","setIsPlaying","mediaLoaded","setMediaLoaded","metadataLoaded","setMetadataLoaded","error","setError","sliderValue","setSliderValue","sliderPlayedWidth","setSliderPlayedWidth","setDuration","totalDuration","interval","uploading","seekUpdate","seekPosition","isNaN","currentTime","currentMinutes","currentSeconds","getCurrentTime","load","media","reject","onloadedmetadata","Number","MAX_SAFE_INTEGER","ontimeupdate","durationMinutes","durationSeconds","pause","min","max","seekto","Chat","b","setInput","useParams","location","useLocation","match","useRouteMatch","setImagePreview","setMessages","openMenu","setOpenMenu","deleting","setDeleting","setToken","setState","setSeen","typing","setTyping","setSRC","setImage","writeState","setWriteState","setRatio","scrollArrow","setScrollArrow","clientWidth","setClientWidth","firstRender","setFirstRender","sendAnim","setSendAnim","Boolean","setLimitReached","chatBodyRef","lastMessageRef","chatBodyContainer","chatAnim","prevMessages","limit","prevScrollHeight","paginating","paginating2","paginateLoader","setPaginateLoader","messageSentAudio","audio2","messageReceivedAudio","audio1","mediaSnap","mediaChecked","animation","outerHeight","getComputedStyle","marginTop","inputText","imageToUpload","roomInfo","split","imageName","messageToSend","imageUrl","Compressor","quality","maxWidth","success","deleteRoom","room","get","fetchedMessages","fetchedAudios","fecthedImages","docs","usersChats","Set","all","delete","img","aud","userChat","fetchMessages","orderBy","onSnapshot","snapshot","toDate","reverse","paginate","listenToImg","docID","filter","snap","listenToAudio","useLayoutEffect","nodeArr","lastMHeight","node","anime","targets","easing","complete","scrollChatBody","x","init","empty","clientHeight","h","z","round","widthRatio","reader","FileReader","onload","readAsDataURL","cursor","htmlFor","Menu","anchorEl","open","onClose","keepMounted","MenuItem","messageArr","parentNode","obj","getBoundingClientRect","offsetWidth","clickImagePreview","appear","clearTimeout","unmountOnExit","TransitionGroup","component","Transition","Login","Logo","Button","signInWithRedirect","catch","Google","Loader","useFetchData","limitNumber","initCount","snapHandler","dataUnsub","setData","snapCount","fetchData","getData","App","loader","setLoader","pwaEvent","setPwaEvent","updating","setUpdating","checkingVersion","setCheckingVerison","setChats","chatsFetched","setChatsFetched","initRoomsData","onlineStateListener","useRoomsData","setRoomsData","menus","onAuthStateChanged","authUser","requestPermission","getToken","version","previousVersion","localStorage","getItem","setItem","includeMetadataChanges","docChanges","metadata","fromCache","every","isOfflineForDatabase","last_changed","isOnlineForDatabase","userStatusFirestoreRef","userStatusDatabaseRef","isOfflineForFirestore","isOnlineForFirestore","on","onDisconnect","setOnlineStatus","find","isLocalhost","hostname","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","constraints","webkitGetUserMedia","mozGetUserMedia","call","Error","ReactDOM","render","StrictMode","getElementById","process","href","origin","fetch","headers","response","contentType","status","indexOf","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.a38b6214.chunk.js","sourcesContent":["export default function scalePage() {\r\n    if (window.innerHeight > 768 && window.innerWidth > 1366) {\r\n        const currentRatio = window.innerHeight / window.innerWidth;\r\n        const ratio = 768 / 1366;\r\n        if (ratio < currentRatio) {\r\n            return {\r\n                width: 1366,\r\n                height: window.innerHeight * (1366 / window.innerWidth),\r\n                transform: `scale(${window.innerWidth / 1366})`\r\n            };\r\n        } else if (ratio > currentRatio) {\r\n            return {\r\n                width: window.innerWidth * (768 / window.innerHeight),\r\n                height: 768,\r\n                transform: `scale(${window.innerHeight / 768})`\r\n            };\r\n        } else {\r\n            return {\r\n                width: 1366,\r\n                height: 768,\r\n                transform: `scale(${window.innerHeight / 768})`\r\n            };\r\n        };\r\n    };\r\n    return {\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n        transform: `scale(1)`\r\n    };\r\n};","import scalePage from \"../components/scalePage\";\r\n\r\nexport const initialState = {\r\n    user: null,\r\n    path: \"\",\r\n    pathID: \"\",\r\n    dispatchMessages: {},\r\n    audioID: null,\r\n    roomsData: {},\r\n    page: scalePage()\r\n}\r\n\r\nexport const  actionTypes = {\r\n    SET_USER: \"SET_USER\",\r\n    SET_MESSAGES : \"SET_MESSAGES\",\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n    //console.log(action)\r\n    switch (action.type) {\r\n        case \"set_scale_page\" :\r\n            return {\r\n                ...state,\r\n                page: action.page\r\n            }\r\n        case actionTypes.SET_USER :\r\n            return {\r\n                ...state,\r\n                user: action.user\r\n            }\r\n        case \"SET_PATH\" :\r\n            return {\r\n                ...state,\r\n                path: action.path\r\n            }\r\n        case \"set_path_id\" :\r\n            return {\r\n                ...state,\r\n                pathID: action.id\r\n            }\r\n        case actionTypes.SET_MESSAGES :\r\n            const dispatchMessages = state.dispatchMessages;\r\n            //console.log(\"dispatch messages: \", dispatchMessages[action.id]);\r\n            //console.log(\"action messages: \", action.messages);\r\n            if (action.update) {\r\n                //console.log(\"updating\");\r\n                if (dispatchMessages[action.id].messages) {\r\n                    //console.log(\"messages exist\")\r\n                    if (dispatchMessages[action.id].messages.length === 0) {\r\n                        //console.log(\"messages length is 0\");\r\n                        if (action.messages.length > 0) {\r\n                            //console.log(\"action messages length greater than 0\");\r\n                            dispatchMessages[action.id] = {\r\n                                messages: action.messages, \r\n                                limitReached: dispatchMessages[action.id].limitReached,\r\n                                firstMessageID: dispatchMessages[action.id].firstMessageID,\r\n                                audio: state.pathID === action.id,\r\n                            };\r\n                        }  \r\n                    } else if (dispatchMessages[action.id].messages.length > 0 && action.messages.length === 0) {\r\n                        //console.log(\"messages were deleted\");\r\n                        dispatchMessages[action.id] = {\r\n                            messages: [], \r\n                            limitReached: true,\r\n                            firstMessageID: undefined,\r\n                            audio: false,\r\n                        };\r\n                    } else {\r\n                        const s = dispatchMessages[action.id].messages.length - action.messages.length;\r\n                        var isSame = s === 0 ? false : true;\r\n                        if (s >= 0) {\r\n                            //console.log(\"difference greater or equal than 0\");\r\n                            for (var i = 0; i < action.messages.length - 2; i++) {\r\n                                //console.log(\"iterating at: \", i);\r\n                                //console.log(\"action message: \", action.messages[i]);\r\n                                //console.log(\"dispatch message: \", dispatchMessages[action.id].messages[s + i + 1]);\r\n                                isSame = action.messages[i].id === dispatchMessages[action.id].messages[s + i + 1].id;\r\n                                if (!isSame) {\r\n                                    //console.log(\"it's not the same\");\r\n                                    break;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            //console.log(\"difference is less than 0\");\r\n                            for (i = 0; i < dispatchMessages[action.id].messages.length - 2; i++) {\r\n                                isSame = action.messages[i].id === dispatchMessages[action.id].messages[i].id;\r\n                                if (!isSame) {\r\n                                    //console.log(\"it's not the same\");\r\n                                    break;\r\n                                };\r\n                            };\r\n                        };\r\n                        if (isSame) {\r\n                            //console.log(\"it's the same\");\r\n                            //console.log(\"last action message: \", action.messages[action.messages.length - 1]);\r\n                            //console.log(\"s: \", s);\r\n                            var arr;\r\n                            if (s >= 0) {\r\n                                //console.log(\"sliced: \", dispatchMessages[action.id].messages.slice(0, s + 1));\r\n                                arr = [...dispatchMessages[action.id].messages.slice(0, s + 1), ...action.messages];\r\n                            } else {\r\n                                //console.log(\"sliced: \", dispatchMessages[action.id].messages.slice(0, -s + 1));\r\n                                arr = [...action.messages]; \r\n                            }\r\n                            dispatchMessages[action.id] = {\r\n                                messages: arr, \r\n                                limitReached: dispatchMessages[action.id].limitReached,\r\n                                firstMessageID: dispatchMessages[action.id].firstMessageID,\r\n                                audio: state.pathID === action.id && isSame,\r\n                            };\r\n                        };\r\n                    };\r\n                };\r\n                //console.log(\"returned dispatchMessages from updating: \", dispatchMessages[action.id]);\r\n                return {\r\n                    ...state,\r\n                    dispatchMessages,\r\n                };\r\n            };\r\n            //console.log(\"not updating\");\r\n            dispatchMessages[action.id] = {\r\n                messages: action.messages, \r\n                limitReached: dispatchMessages[action.id].firstMessageID === \"no id\" ? true : action.messages[0]?.id === dispatchMessages[action.id].firstMessageID,\r\n                firstMessageID: dispatchMessages[action.id].firstMessageID,\r\n                audio: false\r\n            }\r\n            return {\r\n                ...state,\r\n                dispatchMessages\r\n            }\r\n        case \"set_audio_false\" : \r\n            const newMessages = state.dispatchMessages;\r\n            newMessages[action.id] = {\r\n                ...newMessages[action.id],\r\n                audio: false\r\n            };\r\n            return {\r\n                ...state,\r\n                dispatchMessages: newMessages\r\n            };\r\n        case \"set_firstMessage\" :\r\n            const s = state.dispatchMessages;\r\n            if (s[action.id]) {\r\n                s[action.id].firstMessageID = action.firstMessageID;\r\n            } else {\r\n                s[action.id] = {\r\n                    firstMessageID: action.firstMessageID\r\n                };\r\n            };\r\n            return {\r\n                ...state,\r\n                dispatchMessages: s\r\n            };\r\n        case \"update_media\" :\r\n            const f = state.dispatchMessages;\r\n            const updatedMessages = f[action.roomID].messages;\r\n            const e = updatedMessages.findIndex(cur => cur.id === action.id);\r\n            updatedMessages[e] = {\r\n                ...updatedMessages[e],\r\n                ...action.data\r\n            };\r\n            //console.log(\"updated media: \", f[action.roomID]);\r\n            f[action.roomID] = {\r\n                messages: updatedMessages, \r\n                limitReached: f[action.roomID].limitReached,\r\n                firstMessageID: f[action.roomID].firstMessageID\r\n            }\r\n            return {\r\n                ...state,\r\n                dispatchMessages: f,\r\n            }\r\n        case \"add_rooms_data\" :\r\n            const newRoomsData = {...state.roomsData};\r\n            //console.log(\"rooms data: \", state.roomsData);\r\n            newRoomsData[action.roomID] = {\r\n                lastMessageListener: action.lastMessageListener,\r\n                onlineStatelistener: action.onlineStatelistener,\r\n                roomID: action.roomID\r\n            }\r\n            return {\r\n                ...state,\r\n                roomsData: newRoomsData\r\n            }\r\n        case \"update_rooms_data\" :\r\n            const roomsData = {...state.roomsData};\r\n            //console.log(\"rooms data: \", state.roomsData);\r\n            if (action.data !== roomsData[action.roomID][action.dataType]) {\r\n                roomsData[action.roomID] = {\r\n                    ...roomsData[action.roomID],\r\n                    [action.dataType] : action.data\r\n                }\r\n                return {\r\n                    ...state,\r\n                    roomsData: roomsData\r\n                }\r\n            }\r\n            return state;\r\n        default: \r\n            return state;\r\n    }\r\n}\r\n\r\nexport default reducer;","import {createContext, useReducer, useContext} from \"react\";\r\nimport { actionTypes } from './reducer'\r\n\r\nexport const StateContext = createContext();\r\n\r\nexport const StateProvider = ({ reducer, initialState, children}) => (\r\n    <StateContext.Provider value={[...useReducer(reducer, initialState), actionTypes]}>\r\n        {children}\r\n    </StateContext.Provider>\r\n);\r\n\r\nexport const useStateValue = () => useContext(StateContext);","import {useEffect,  memo, useRef, useState} from 'react';\r\nimport Avatar from '@mui/material/Avatar';\r\nimport MicTwoToneIcon from '@mui/icons-material/MicTwoTone';\r\nimport InsertPhotoTwoToneIcon from '@mui/icons-material/InsertPhotoTwoTone';\r\nimport SearchTwoToneIcon from '@mui/icons-material/SearchTwoTone';\r\nimport CancelTwoToneIcon from '@mui/icons-material/CancelTwoTone';\r\nimport '../styles/SidebarChat.css';\r\nimport { Link } from 'react-router-dom';\r\nimport { CircularProgress } from '@mui/material';\r\nimport { useStateValue } from '../states/StateProvider';\r\n//window\r\nfunction SidebarChat({ dataList, title, path, fetchList}) {\r\n    const [{roomsData, page, pathID}, dispatch] = useStateValue();\r\n    const [scrollFetch, setScrollFetch] = useState(false);\r\n    const [list, setList] = useState(null);\r\n    const sidebarChatContainer = useRef();\r\n\r\n    useEffect(() => {\r\n        var a = null;\r\n        if (fetchList) {\r\n            a = function () {\r\n                if (parseInt(sidebarChatContainer.current.scrollTop) === sidebarChatContainer.current.scrollHeight - sidebarChatContainer.current.offsetHeight) {\r\n                    fetchList(setScrollFetch);\r\n                };\r\n            };\r\n            if (dataList?.length > 0) {\r\n                sidebarChatContainer.current.addEventListener(\"scroll\", a);\r\n            };\r\n        };\r\n        const clean = sidebarChatContainer.current;\r\n        return () => {\r\n            if (a) {\r\n                //console.log(\"removing event\");\r\n                clean.removeEventListener(\"scroll\", a);\r\n                \r\n            };\r\n        };\r\n    }, [dataList, fetchList]);\r\n    \r\n    useEffect(() => {\r\n        //console.log(dataList);\r\n        //console.log(list)\r\n        if (dataList?.length === list?.length) {\r\n            setTimeout(() => {\r\n                Array.from(document.querySelectorAll('.animate')).forEach((cur,i) => {\r\n                    setTimeout(() => {\r\n                        cur.classList.remove(\"animate\");\r\n                    }, 50 * i);\r\n                });\r\n            }, 10);\r\n        };\r\n    }, [dataList, list]);\r\n\r\n    useEffect(() => {\r\n        if (dataList) {\r\n            const arr = [];\r\n            dataList.forEach(data => {\r\n                //console.log(\"data: \", data);\r\n                //console.log(\"rooms data: \", roomsData[data.id]);\r\n                if (data) {\r\n                    const onlineState = roomsData[data.id]?.onlineState ? roomsData[data.id].onlineState : data.state;\r\n                    const lastMessage = title === \"Search Result\" ? null : roomsData[data.id]?.lastMessage ? roomsData[data.id].lastMessage : data.lastMessage;\r\n                    if (title === \"Rooms\" || title === \"Search Result\" || title === \"Chats\" && roomsData[data.id].lastMessage || title !== \"Chats\" && roomsData[data.id]) {\r\n                        arr.push(<Link className=\"link\" key={data.id} to={{\r\n                            pathname: path ? `${path}/room/${data.id}` : `/room/${data.id}`,\r\n                            state: {\r\n                                photoURL: `${data.photoURL ? data.photoURL : `https://avatars.dicebear.com/api/human/${data.id}.svg`}`,\r\n                                name: data.name,\r\n                                userID: data.userID ? data.userID : null,\r\n                                state: data.state\r\n                            }\r\n                        }} >\r\n                            <div \r\n                                className={`sidebar__chat animate`}\r\n                            >\r\n                                <div className=\"avatar__container\">\r\n                                    <Avatar style={{width: 45,height: 45}} src={`${data.photoURL ? data.photoURL : `https://avatars.dicebear.com/api/human/${data.id}.svg`}`} />\r\n                                    {onlineState=== \"online\" ? <div className=\"online\"></div> : null}\r\n                                </div>\r\n                                <div className=\"sidebar__chat--info\">\r\n                                    <h2 \r\n                                        dangerouslySetInnerHTML={{__html: title === \"Search Result\" ? data._highlightResult.name.value : data.name}}\r\n                                        style={{\r\n                                            width: page.width <= 760 ? page.width - 126 : page.width * 0.315 - 126,\r\n                                            marginBottom: lastMessage?.message || lastMessage ? 8 : 0,\r\n                                        }}\r\n                                    ></h2>\r\n                                    <p style={{width: page.width <= 760 ? page.width - 126 : page.width * 0.315 - 126}}>\r\n                                        {lastMessage?.message ? \r\n                                            <><InsertPhotoTwoToneIcon style={{width: 19,height: 19}} /> <span style={{width: page.width <= 760 ? page.width - 150 : page.width * 0.315 - 150}}>{lastMessage.message}</span> </>\r\n                                            : lastMessage?.audio ?\r\n                                            <><MicTwoToneIcon style={{width: 19,height: 19}} /><span style={{width: page.width <= 760 ? page.width - 150 : page.width * 0.315 - 150}}>{lastMessage.time}</span></>\r\n                                            : lastMessage?.message === \"\" ?\r\n                                            <><InsertPhotoTwoToneIcon style={{width: 19,height: 19}} /> <span style={{width: page.width <= 760 ? page.width - 150 : page.width * 0.315 - 150}}>Photo</span> </>\r\n                                        :lastMessage}\r\n                                    </p>\r\n                                </div>\r\n                                {data?.unreadMessages && pathID !== data.id ?\r\n                                    <div className=\"sidebar__chat--unreadMessages\">\r\n                                        <div>\r\n                                            {data.unreadMessages}\r\n                                        </div>\r\n                                    </div>\r\n                                :null}\r\n                            </div>\r\n                        </Link>);\r\n                    }\r\n                } else {\r\n                    arr.push(null);\r\n                }\r\n            });\r\n            setList(arr)\r\n        }\r\n    }, [dataList, roomsData, page, pathID]);\r\n\r\n    useEffect(() => {\r\n        if (page.width <= 760) {\r\n            dispatch({type: \"SET_PATH\", path: path});\r\n        } else {\r\n            dispatch({type: \"SET_PATH\", path: \"\"})\r\n        }\r\n    }, [path, page]);\r\n\r\n    return (\r\n        <div ref={sidebarChatContainer} className=\"sidebar__chat--container\">\r\n            <h2 className=\"animate\">{title} </h2>\r\n            {dataList?.length > 0 ? list : dataList === null && title !== \"Chats\" ?\r\n                <div className=\"loader__container sidebar__loader\">\r\n                    <CircularProgress />\r\n                </div>\r\n                :\r\n                <div className=\"no-result\">\r\n                    <div>\r\n                        <SearchTwoToneIcon />\r\n                        <div className=\"cancel-root\">\r\n                            <CancelTwoToneIcon />\r\n                        </div>\r\n                    </div>\r\n                    <h2>No {title} found </h2>\r\n                </div>\r\n                \r\n            }\r\n            <div className=\"loader__container scrollFetch\">\r\n                {scrollFetch ? <CircularProgress /> : null}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default memo(SidebarChat);\r\n","import firebase from \"firebase/app\";\r\nimport \"firebase/auth\";\r\nimport \"firebase/firestore\";\r\nimport \"firebase/database\"\r\nimport \"firebase/messaging\";\r\nimport \"firebase/storage\"\r\n\r\nconst firebaseConfig = {\r\n\tapiKey: \"AIzaSyDBAA9fds7TLHmYzYGsd1FxdO9_0adAdnA\",\r\n  authDomain: \"walfchat.firebaseapp.com\",\r\n  databaseURL: \"https://walfchat-default-rtdb.firebaseio.com\",\r\n  projectId: \"walfchat\",\r\n  storageBucket: \"walfchat.appspot.com\",\r\n  messagingSenderId: \"840763157061\",\r\n  appId: \"1:840763157061:web:ebfcb5307fe2794e05512c\",\r\n  measurementId: \"G-NR6C5HBKPW\"\r\n};/*use your own configuration*/\r\n\r\nconst firebaseApp = firebase.initializeApp(firebaseConfig);\r\n\r\nconst enablePersistence = firebaseApp.firestore().enablePersistence();\r\nconst db = firebaseApp.firestore();\r\nconst db2 = firebaseApp.database();\r\nconst auth = firebaseApp.auth();\r\nconst provider = new firebase.auth.GoogleAuthProvider();\r\nvar provider2 = new firebase.auth.FacebookAuthProvider();\r\nconst createTimestamp = firebase.firestore.FieldValue.serverTimestamp;\r\nconst createTimestamp2 = firebase.database.ServerValue.TIMESTAMP;\r\nconst messaging = \"serviceWorker\" in navigator && \"PushManager\" in window ?  firebase.messaging() : null;\r\nconst fieldIncrement = firebase.firestore.FieldValue.increment;\r\nconst arrayUnion = firebase.firestore.FieldValue.arrayUnion;\r\nconst storage = firebase.storage().ref(\"images\");\r\nconst audioStorage = firebase.storage().ref(\"audios\");\r\nconst videoStorage = firebase.storage().ref(\"videos\");\r\nconst documentStorage = firebase.storage().ref(\"documents\");\r\n\r\n//set firebase loaded to \"true\" in app.js\r\nasync function loadFirebase(setFirebaseLoaded) {\r\n\tawait enablePersistence;\r\n\tawait db;\r\n\tsetFirebaseLoaded(true);\r\n}\r\n//db.disableNetwork();\r\n\r\nexport {loadFirebase, auth , provider, provider2, createTimestamp, messaging, fieldIncrement, arrayUnion, storage, audioStorage, videoStorage, documentStorage, db2, createTimestamp2};\r\nexport default db;\r\n","export default __webpack_public_path__ + \"static/media/notification.d63feaf4.mp3\";","import { useEffect, useState, memo, useRef } from \"react\";\r\nimport SidebarChat from \"./SidebarChat\";\r\nimport { IconButton, Avatar } from '@mui/material';\r\nimport SecurityUpdateIcon from '@mui/icons-material/SecurityUpdate';\r\nimport LogoutIcon from '@mui/icons-material/Logout';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport HomeTwoToneIcon from '@mui/icons-material/HomeTwoTone';\r\nimport EmailTwoToneIcon from '@mui/icons-material/EmailTwoTone';\r\nimport GroupsTwoToneIcon from '@mui/icons-material/GroupsTwoTone';\r\nimport AddBoxTwoToneIcon from '@mui/icons-material/AddBoxTwoTone';\r\nimport db, { auth, createTimestamp } from \"../firebase/firebase\";\r\nimport { useStateValue } from \"../states/StateProvider\";\r\nimport { NavLink, Route, useHistory, Switch } from \"react-router-dom\";\r\nimport algoliasearch from \"algoliasearch\";\r\nimport \"../styles/Sidebar.css\";\r\nimport audio from \"../sounds/notification.mp3\";\r\n\r\nconst index = algoliasearch(\r\n  \"JIMBGKZ8LO\",\r\n  \"f050ba62d4f7458801bbfb4c7b315ad8\"\r\n).initIndex(\"chatapp\");\r\n\r\nfunction Sidebar({ chats, pwa, rooms, fetchRooms, users, fetchUsers }) {\r\n  const [searchList, setSearchList] = useState(null);\r\n  const [searchInput, setSearchInput] = useState(\"\");\r\n  const [menu, setMenu] = useState(1);\r\n  const [mounted, setMounted] = useState(false);\r\n  const [{ user, page, pathID }] = useStateValue();\r\n  let history = useHistory();\r\n  const notification = new Audio(audio);\r\n  const prevUnreadMessages = useRef(\r\n    (() => {\r\n      const data = {};\r\n      chats.forEach((cur) =>\r\n        cur.unreadMessages || cur.unreadMessages === 0\r\n          ? (data[cur.id] = cur.unreadMessages)\r\n          : null\r\n      );\r\n      return data;\r\n    })()\r\n  );\r\n\r\n  var Nav;\r\n  if (page.width > 760) {\r\n    Nav = (props) => (\r\n      <div\r\n        className={`${props.classSelected ? \"sidebar__menu--selected\" : \"\"}`}\r\n        onClick={props.click}\r\n      >\r\n        {props.children}\r\n      </div>\r\n    );\r\n  } else {\r\n    Nav = NavLink;\r\n  }\r\n\r\n  async function search(e) {\r\n    if (e) {\r\n      document.querySelector(\".sidebar__search input\").blur();\r\n      e.preventDefault();\r\n    }\r\n    if (page.width <= 760) {\r\n      history.push(\"/search?\" + searchInput);\r\n    }\r\n    setSearchList(null);\r\n    if (menu !== 4) {\r\n      setMenu(4);\r\n    }\r\n    const result = (await index.search(searchInput)).hits.map((cur) =>\r\n      cur.objectID !== user.uid\r\n        ? {\r\n            ...cur,\r\n            id: cur.photoURL\r\n              ? cur.objectID > user.uid\r\n                ? cur.objectID + user.uid\r\n                : user.uid + cur.objectID\r\n              : cur.objectID,\r\n            userID: cur.photoURL ? cur.objectID : null,\r\n          }\r\n        : null\r\n    );\r\n    //console.log(result);\r\n    setSearchList(result);\r\n  }\r\n\r\n  const createChat = () => {\r\n    const roomName = prompt(\"Type the name of your room\");\r\n    if (roomName) {\r\n      db.collection(\"rooms\").add({\r\n        name: roomName,\r\n        timestamp: createTimestamp(),\r\n        lastMessage: \"\",\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const data = {};\r\n    chats.forEach((cur) => {\r\n      if (cur.unreadMessages || cur.unreadMessages === 0) {\r\n        if (\r\n          (cur.unreadMessages > prevUnreadMessages.current[cur.id] ||\r\n            (!prevUnreadMessages.current[cur.id] &&\r\n              prevUnreadMessages.current[cur.id] !== 0)) &&\r\n          pathID !== cur.id\r\n        ) {\r\n          notification.play();\r\n        }\r\n        data[cur.id] = cur.unreadMessages;\r\n      }\r\n    });\r\n    prevUnreadMessages.current = data;\r\n  }, [chats, pathID]);\r\n\r\n  useEffect(() => {\r\n    if (page.width <= 760 && chats && !mounted) {\r\n      setMounted(true);\r\n      setTimeout(() => {\r\n        document.querySelector(\".sidebar\").classList.add(\"side\");\r\n      }, 10);\r\n    }\r\n  }, [chats, mounted]);\r\n\r\n  return (\r\n    <div\r\n      className=\"sidebar\"\r\n      style={{\r\n        minHeight: page.width <= 760 ? page.height : \"auto\",\r\n      }}\r\n    >\r\n      <div className=\"sidebar__header\">\r\n        <div className=\"sidebar__header--left\">\r\n          <Avatar src={user?.photoURL} />\r\n          <h4>{user?.displayName} </h4>\r\n        </div>\r\n        <div className=\"sidebar__header--right\">\r\n          <IconButton\r\n            onClick={() => {\r\n              if (pwa) {\r\n                console.log(\"prompting the pwa event\");\r\n                pwa.prompt();\r\n              } else {\r\n                console.log(\"pwa event is undefined\");\r\n              }\r\n            }}\r\n          >\r\n            <SecurityUpdateIcon />\r\n          </IconButton>\r\n          <IconButton\r\n            onClick={() => {\r\n              auth.signOut();\r\n              db.doc(\"/users/\" + user.uid).set(\r\n                { state: \"offline\" },\r\n                { merge: true }\r\n              );\r\n              history.replace(\"/chats\");\r\n            }}\r\n          >\r\n            <LogoutIcon />\r\n          </IconButton>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"sidebar__search\">\r\n        <form className=\"sidebar__search--container\">\r\n          <SearchIcon />\r\n          <input\r\n            value={searchInput}\r\n            onChange={(e) => setSearchInput(e.target.value)}\r\n            placeholder=\"Search for users or rooms\"\r\n            type=\"text\"\r\n          />\r\n          <button\r\n            style={{ display: \"none\" }}\r\n            type=\"submit\"\r\n            onClick={search}\r\n          ></button>\r\n        </form>\r\n      </div>\r\n\r\n      <div className=\"sidebar__menu\">\r\n        <Nav\r\n          classSelected={menu === 1 ? true : false}\r\n          to=\"/chats\"\r\n          click={() => setMenu(1)}\r\n          activeClassName=\"sidebar__menu--selected\"\r\n        >\r\n          <div className=\"sidebar__menu--home\">\r\n            <HomeTwoToneIcon />\r\n            <div className=\"sidebar__menu--line\"></div>\r\n          </div>\r\n        </Nav>\r\n        <Nav\r\n          classSelected={menu === 2 ? true : false}\r\n          to=\"/rooms\"\r\n          click={() => setMenu(2)}\r\n          activeClassName=\"sidebar__menu--selected\"\r\n        >\r\n          <div className=\"sidebar__menu--rooms\">\r\n            <EmailTwoToneIcon />\r\n            <div className=\"sidebar__menu--line\"></div>\r\n          </div>\r\n        </Nav>\r\n        <Nav\r\n          classSelected={menu === 3 ? true : false}\r\n          to=\"/users\"\r\n          click={() => setMenu(3)}\r\n          activeClassName=\"sidebar__menu--selected\"\r\n        >\r\n          <div className=\"sidebar__menu--users\">\r\n            <GroupsTwoToneIcon />\r\n            <div className=\"sidebar__menu--line\"></div>\r\n          </div>\r\n        </Nav>\r\n      </div>\r\n\r\n      {page.width <= 760 ? (\r\n        <>\r\n          <Switch>\r\n            <Route path=\"/users\">\r\n              <SidebarChat\r\n                key=\"users\"\r\n                fetchList={fetchUsers}\r\n                dataList={users}\r\n                title=\"Users\"\r\n                path=\"/users\"\r\n              />\r\n            </Route>\r\n            <Route path=\"/rooms\">\r\n              <SidebarChat\r\n                key=\"rooms\"\r\n                fetchList={fetchRooms}\r\n                dataList={rooms}\r\n                title=\"Rooms\"\r\n                path=\"/rooms\"\r\n              />\r\n            </Route>\r\n            <Route path=\"/search\">\r\n              <SidebarChat\r\n                key=\"search\"\r\n                dataList={searchList}\r\n                title=\"Search Result\"\r\n                path=\"/search\"\r\n              />\r\n            </Route>\r\n            <Route path=\"/chats\">\r\n              <SidebarChat\r\n                key=\"chats\"\r\n                dataList={chats}\r\n                title=\"Chats\"\r\n                path=\"/chats\"\r\n              />\r\n            </Route>\r\n          </Switch>\r\n        </>\r\n      ) : menu === 1 ? (\r\n        <SidebarChat key=\"chats\" dataList={chats} title=\"Chats\" />\r\n      ) : menu === 2 ? (\r\n        <SidebarChat\r\n          key=\"rooms\"\r\n          fetchList={fetchRooms}\r\n          dataList={rooms}\r\n          title=\"Rooms\"\r\n        />\r\n      ) : menu === 3 ? (\r\n        <SidebarChat\r\n          key=\"users\"\r\n          fetchList={fetchUsers}\r\n          dataList={users}\r\n          title=\"Users\"\r\n        />\r\n      ) : menu === 4 ? (\r\n        <SidebarChat key=\"search\" dataList={searchList} title=\"Search Result\" />\r\n      ) : null}\r\n      <div className=\"sidebar__chat--addRoom\" onClick={createChat}>\r\n        <IconButton>\r\n          <AddBoxTwoToneIcon />\r\n        </IconButton>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(Sidebar);\r\n","import {memo, useEffect, useState} from \"react\";\r\nimport CancelTwoToneIcon from '@mui/icons-material/CancelTwoTone';\r\nimport \"../styles/MediaPreview.css\";\r\n\r\nexport default memo(function MediaPreview({imageSRC, mediaPreview, close}) {\r\n\tconst [height, setHeight] = useState(\"\");\r\n\r\n\tuseEffect(() => {\r\n\t\tsetHeight(document.querySelector('.chat__body--container').offsetHeight);\r\n\t}, [])\r\n\r\n\treturn(\r\n\t\t<div \r\n\t\t\tref={mediaPreview} \r\n\t\t\tclassName=\"mediaPreview\"\r\n\t\t\tstyle={{\r\n\t\t\t\theight: height,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<CancelTwoToneIcon onClick={close} />\r\n\t\t\t<img key={imageSRC} src={imageSRC} alt=\"\" />\r\n\t\t</div>\r\n\t)\r\n})","import { useEffect, memo, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { useHistory } from 'react-router-dom';\r\nimport { useStateValue } from '../states/StateProvider';\r\nimport CancelTwoToneIcon from '@mui/icons-material/CancelTwoTone';\r\nimport \"../styles/ImagePreview.css\"\r\n\r\nexport default memo(function ImagePreview({ imagePreview, animState }) {\r\n    const history = useHistory();\r\n    const [loaded, setLoaded] = useState(false);\r\n    const [{page}] = useStateValue();\r\n    \r\n    useEffect(() => {\r\n        if (loaded) {\r\n            const ratio = page.height / page.width;\r\n            const el = document.querySelector('.imagePreview-container');\r\n            var animW, animH, a;\r\n            const imageRatio = imagePreview.ratio ? imagePreview.ratio : (imagePreview.imgH / imagePreview.imgW);\r\n            if (ratio  < imageRatio) {\r\n                a = true;\r\n                animW = (1 / imageRatio) * page.height;\r\n                animH = page.height;\r\n            } else {\r\n                a = false;\r\n                animH = imageRatio * page.width;\r\n                animW = page.width;\r\n            }\r\n            if (animState === \"entering\" || animState === \"entered\") {\r\n                setTimeout(() => {\r\n                    document.querySelector(\".imagePreview\").style.backgroundColor = \"black\";\r\n                    el.style.borderRadius = \"0px\"\r\n                    el.style.transformOrigin = a ? \"0% 0%\" : \"0% 0%\";\r\n                    el.style.height = imagePreview.imgH + \"px\";\r\n                    el.style.transform = a ? `translateX(${(page.width / 2) - (animW / 2)}px) translateY(0px) scale(${page.height / imagePreview.imgH})` : \r\n                            `translateX(0px) translateY(${(page.height / 2) - (animH / 2)}px) scale(${page.width / imagePreview.width})`\r\n                    setTimeout(() => {\r\n                        document.querySelector('.imagePreview .MuiSvgIcon-root').classList.add(\"close-animate\")\r\n                    }, 300)\r\n                }, 10)\r\n            } else if (animState === \"exiting\") {\r\n                setTimeout(() => {\r\n                    document.querySelector('.imagePreview .MuiSvgIcon-root').classList.remove(\"close-animate\")\r\n                    setTimeout(() => {\r\n                        document.querySelector(\".imagePreview\").style.backgroundColor = \"transparent\"\r\n                    }, 200)\r\n                    el.style.borderRadius = \"10px\"\r\n                    el.style.height = imagePreview.height + \"px\";\r\n                    el.style.transform = `translateX(${imagePreview.left}px) translateY(${imagePreview.top}px) scale(1)`;\r\n                }, 10)\r\n            }\r\n        }\r\n    }, [animState, loaded]);\r\n\r\n    const style = {\r\n        transform:`translateX(${imagePreview.left}px) translateY(${imagePreview.top}px) scale(1)`,\r\n        width: imagePreview.width,\r\n        height: imagePreview.height,\r\n    }\r\n\r\n    const imgStyle = {}\r\n\r\n    if (page.height / page.width > imagePreview.ratio || page.height / page.width === imagePreview.ratio) {\r\n        imgStyle.minWidth = \"100%\";\r\n    } else {\r\n        imgStyle.minHeight = \"100%\";\r\n        if (imagePreview.imgW < imagePreview.width) {\r\n            imgStyle.minWidth = \"100%\";\r\n        }\r\n    }\r\n       \r\n    return createPortal(\r\n        <div className=\"imagePreview\" onClick={() => document.querySelector('.imagePreview .MuiSvgIcon-root').classList.toggle(\"close-animate\")}>\r\n            <CancelTwoToneIcon onClick={() => history.goBack()} />\r\n            <div\r\n                className=\"imagePreview-container\"\r\n                style={style}\r\n            >\r\n                <img style={imgStyle} onLoad={() => setLoaded(true)} src={imagePreview.src} alt=\"\" />\r\n            </div>\r\n        </div>\r\n    , document.querySelector(\".app\"))\r\n})","import { v4 as uuidv4 } from 'uuid';\r\n\r\nexport default function record (){\r\n  return new Promise(resolve => {\r\n    navigator.mediaDevices.getUserMedia({ audio: true })\r\n      .then(stream => {\r\n        const mediaRecorder = new MediaRecorder(stream);\r\n        const audioChunks = [];\r\n\r\n        mediaRecorder.addEventListener(\"dataavailable\", event => {\r\n          audioChunks.push(event.data);\r\n        });\r\n\r\n        const start = () => {\r\n          mediaRecorder.start();\r\n        };\r\n\r\n        const stop = () => {\r\n          return new Promise(resolve => {\r\n            mediaRecorder.addEventListener(\"stop\", () => {\r\n              const audioName = uuidv4();\r\n              const audioFile = new File(audioChunks, audioName, {type: \"audio/mpeg\"});\r\n              const audioUrl = URL.createObjectURL(audioFile);\r\n              const audio = new Audio(audioUrl);\r\n              const play = () => {\r\n                audio.play();\r\n              };\r\n\r\n              resolve({ audioFile, audioUrl, play, audioName });\r\n            });\r\n\r\n            mediaRecorder.stop();\r\n          });\r\n        };\r\n\r\n        resolve({ start, stop });\r\n      });\r\n  });\r\n};","import { memo, useState, useEffect, useRef } from 'react';\r\nimport MicTwoToneIcon from '@mui/icons-material/MicTwoTone';\r\nimport SendTwoToneIcon from '@mui/icons-material/SendTwoTone';\r\nimport CancelTwoToneIcon from '@mui/icons-material/CancelTwoTone';\r\nimport CheckCircleTwoToneIcon from '@mui/icons-material/CheckCircleTwoTone';\r\nimport db, { createTimestamp, fieldIncrement, audioStorage } from \"../firebase/firebase\";\r\nimport { useStateValue } from '../states/StateProvider';\r\nimport { CSSTransition } from \"react-transition-group\";\r\nimport recorder from \"./recorder.js\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport \"../styles/ChatFooter.css\";\r\nconst wait = time => new Promise(resolve => setTimeout(resolve, time));\r\n\r\nexport default memo(function ChatFooter({input, handleFocus, change, sendMessage, setFocus, image, focus, state, token, roomID, setAudioID}) {\r\n\tconst [recording, setRecording] = useState(false);\r\n\tconst [recordingTimer, setRecordingTimer] = useState(\"00:00\");\r\n\tconst [{ user }] = useStateValue();\r\n\tconst recordingEl = useRef();\r\n\tconst inputRef = useRef();\r\n\tconst timerInterval = useRef();\r\n\tconst record = useRef();\r\n\r\n\tfunction handleBlur(event) {\r\n\t    if (!event.currentTarget.contains(event.relatedTarget) && !recording) {\r\n\t    \tsetFocus(false)\r\n\t    }\r\n\t}\r\n\r\n\tasync function sendAudio(audioFile, timer, audioName) {\r\n\t\tdb.collection(\"rooms\").doc(roomID).set({\r\n            [user.uid]: false,\r\n        }, { merge: true });\r\n\t\tdb.collection(\"rooms\").doc(roomID).set({\r\n\t\t\tlastMessage:{\r\n\t\t\t\taudio: true,\r\n\t\t\t\ttime: timer,\r\n\t\t\t},\r\n\t\t\tseen: false\r\n\t\t}, { merge: true });\r\n        if (state.userID) {\r\n        \tdb.collection(\"users\").doc(state.userID).collection(\"chats\").doc(roomID).set({\r\n                timestamp: createTimestamp(),\r\n                photoURL: user.photoURL ? user.photoURL : null,\r\n                name: user.displayName,\r\n                userID: user.uid,\r\n                unreadMessages: fieldIncrement(1),\r\n            }, { merge: true });\r\n            db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\r\n                timestamp: createTimestamp(),\r\n                photoURL: state.photoURL ? state.photoURL : null,\r\n                name: state.name,\r\n                userID: state.userID\r\n            }, { merge: true });\r\n        } else {\r\n        \tdb.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\r\n                timestamp: createTimestamp(),\r\n                photoURL: state.photoURL ? state.photoURL : null,\r\n                name: state.name,\r\n            });\r\n        };\r\n        const doc = await db.collection(\"rooms\").doc(roomID).collection(\"messages\").add({\r\n        \tname: user.displayName,\r\n            uid: user.uid,\r\n            timestamp: createTimestamp(),\r\n            time: new Date().toUTCString(),\r\n            audioUrl: \"uploading\",\r\n            audioName,\r\n            audioPlayed: false\r\n        });\r\n        await audioStorage.child(audioName).put(audioFile);\r\n        const url = await audioStorage.child(audioName).getDownloadURL();\r\n        db.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(doc.id).update({\r\n            audioUrl: url\r\n        });\r\n        if (state.userID && token !== \"\") {\r\n        \tdb.collection(\"notifications\").add({\r\n\t            userID: user.uid,\r\n\t            title: user.displayName,\r\n\t            body: \"🎙️ \" + timer,\r\n\t            photoURL: user.photoURL,\r\n\t            token: token\r\n\t        });\r\n        };\r\n\t};\r\n\r\n\tasync function startRecording(e) {\r\n\t\te.preventDefault();\r\n\t\tif (window.navigator.onLine) {\r\n\t\t\tif (focus) {\r\n\t\t\t\tinputRef.current.focus();\r\n\t\t\t}\r\n\t\t\tawait wait(150);\r\n\t\t\trecord.current = await recorder(roomID);\r\n\t\t\tsetAudioID(null);\r\n\t\t\tinputRef.current.style.width = \"calc(100% - 56px)\"\r\n\t\t\tawait wait(305);\r\n\t\t\tsetRecording(true);\r\n\t\t} else {\r\n\t\t\talert(\"No access to internet !!!\");\r\n\t\t}\r\n\t}\r\n\r\n\tasync function stopRecording() {\r\n\t\tif (focus) {\r\n\t\t\tinputRef.current.focus();\r\n\t\t}\r\n\t\tdb.collection(\"rooms\").doc(roomID).set({\r\n            [user.uid]: false,\r\n        }, { merge: true });\r\n\t\tclearInterval(timerInterval.current);\r\n\t\tconst stopped = record.current.stop();\r\n\t\trecordingEl.current.style.opacity = \"0\";\r\n\t\tawait wait(300);\r\n\t\tsetRecording(false);\r\n\t\tinputRef.current.style.width = \"calc(100% - 112px)\";\r\n\t\tconst time = recordingTimer;\r\n\t\tsetRecordingTimer(\"00:00\");\r\n\t\treturn [stopped, time];\r\n\t}\r\n\r\n\tasync function finishRecording() {\r\n\t\tvar [audio, time] = await stopRecording();\r\n\t\taudio = await audio;\r\n\t\tsendAudio(audio.audioFile, time, audio.audioName);\r\n\t}\r\n\r\n\tfunction pad(val) {\r\n        var valString = val + \"\";\r\n        if(valString.length < 2) {\r\n            return \"0\" + valString;\r\n        } else {\r\n            return valString;\r\n        }\r\n    }\r\n\r\n\tfunction timer() {\r\n        const start = Date.now();\r\n        timerInterval.current = setInterval(setTime, 100);\r\n\r\n        function setTime() {\r\n            const delta = Date.now() - start; // milliseconds elapsed since start\r\n            const totalSeconds = Math.floor(delta / 1000);\r\n            setRecordingTimer(pad(parseInt(totalSeconds/60)) + \":\" + pad(totalSeconds%60))\r\n        }\r\n\t}\r\n\r\n\tfunction audioInputChange(e) {\r\n\t\tif (window.navigator.onLine) {\r\n\t\t\tconst file = e.target.files[0];\r\n\t\t\tif (file) {\r\n\t\t\t\tsetAudioID(null);\r\n\t\t\t\tconst audioFile = new Audio(URL.createObjectURL(file));\r\n\t\t\t\taudioFile.addEventListener(\"loadedmetadata\", () => {\r\n\t\t\t\t\tconst totalSeconds = Math.floor(audioFile.duration);\r\n\t\t\t\t\tconst time = pad(parseInt(totalSeconds/60)) + \":\" + pad(totalSeconds%60);\r\n\t\t\t\t\tsendAudio(file,time, uuidv4());\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\talert(\"No access to internet !!!\");\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tconst a = async () => {\r\n\t\t\tawait wait(10);\r\n\t\t\trecordingEl.current.style.opacity = \"1\";\r\n\t\t\tawait wait(100);\r\n\t\t\ttimer();\r\n\t\t\tdb.collection(\"rooms\").doc(roomID).set({\r\n                [user.uid]: \"recording\",\r\n            }, { merge: true })\r\n\t\t\trecord.current.start();\r\n\t\t}\r\n\t\tif (recording) {\r\n\t\t\ta();\r\n\t\t}\r\n\t}, [recording]);\r\n\r\n\tconst btnIcons = <>\r\n\t\t<CSSTransition\r\n        \tin={input !== \"\" || (input === \"\" && image)}\r\n        \ttimeout={{\r\n        \t\tenter: 400,\r\n        \t\texit: 200,\r\n        \t}}\r\n        \tclassNames=\"send__animate2\"\r\n        >\r\n        \t<SendTwoToneIcon \r\n            \tstyle={{\r\n                    width: 20,\r\n                    height: 20,\r\n                    color: \"white\"\r\n                }}\r\n            />\r\n        </CSSTransition>\r\n        <CSSTransition\r\n        \tin={!(input !== \"\" || (input === \"\" && image))}\r\n        \ttimeout={{\r\n        \t\tenter: 400,\r\n        \t\texit: 200,\r\n        \t}}\r\n        \tclassNames=\"send__animate\"\r\n        >\r\n        \t<MicTwoToneIcon \r\n            \tstyle={{\r\n            \t\twidth: 24,\r\n                    height: 24,\r\n                    color: \"white\"\r\n            \t}}\r\n            />\r\n    \t</CSSTransition>\r\n\t</>;\r\n\r\n\treturn (\r\n\t\t<div className=\"chat__footer\" onBlur={handleBlur} >\r\n\t        <form>\r\n\t            <input\r\n\t            \tref={inputRef}\r\n\t                value={input}\r\n\t                onClick={handleFocus}\r\n\t                onChange={!recording ? change : null}\r\n\t                onKeyPress={recording ? () => false : null}\r\n\t                onFocus={() => setFocus(true)}\r\n\t                placeholder=\"Type a message\"\r\n\t            />\r\n\t            {navigator.mediaDevices.getUserMedia && window.MediaRecorder ?\r\n\t            \t<button \r\n\t\t            \ttype=\"submit\" \r\n\t\t            \tclass=\"send__btn\" \r\n\t\t            \tonClick={input !== \"\" || (input === \"\" && image) ? sendMessage : startRecording}\r\n\t\t            >\r\n\t\t                {btnIcons}\r\n\t\t            </button>\t\r\n\t\t        :\r\n\t\t        \t<>\r\n\t\t        \t\t<label\r\n\t\t\t        \t\tfor=\"capture\"  \r\n\t\t\t            \tclass=\"send__btn\" \r\n\t\t\t            >\r\n\t\t\t                {btnIcons}\r\n\t\t\t            </label> \r\n\t\t\t        \t<input\r\n\t\t\t        \t\tstyle={{display: \"none\"}} \r\n\t\t\t\t        \ttype=\"file\" \r\n\t\t\t\t            id=\"capture\" \r\n\t\t\t\t            accept=\"audio/*\" \r\n\t\t\t\t            capture\r\n\t\t\t\t            onChange={audioInputChange}  \r\n\t\t\t            />\r\n\t\t        \t</>\r\n\t\t        }\r\n\t            \r\n\t        </form>\r\n\t        {recording ?\r\n\t\t        <div ref={recordingEl} className=\"record\">\r\n\t\t        \t<CancelTwoToneIcon\r\n\t\t        \t\tstyle={{\r\n\t                \t\twidth: 30,\r\n\t\t                    height: 30,\r\n\t\t                    color: \"#F20519\"\r\n\t                \t}}\r\n\t                \tonClick={stopRecording}\r\n\t\t        \t/>\r\n\t\t        \t<div>\r\n\t\t        \t\t<div className=\"record__redcircle\"></div>\r\n\t\t        \t\t<div className=\"record__duration\">{recordingTimer}</div>\r\n\t\t        \t</div>\r\n\t\t        \t<CheckCircleTwoToneIcon\r\n\t\t        \t\tstyle={{\r\n\t                \t\twidth: 30,\r\n\t\t                    height: 30,\r\n\t\t                    color: \"#41BF49\"\r\n\t                \t}}\r\n\t                \tonClick={finishRecording} \r\n\t\t        \t/>\r\n\t\t        </div> : null\r\n\t\t    }\r\n\t    </div>\r\n\t)\r\n})","import { useState, useEffect, memo, useRef } from \"react\";\r\nimport PlayCircleOutlineTwoToneIcon from \"@mui/icons-material/PlayCircleOutlineTwoTone\";\r\nimport PauseCircleOutlineTwoToneIcon from '@mui/icons-material/PauseCircleOutlineTwoTone';\r\nimport { CircularProgress } from '@mui/material';\r\nimport PlayForWorkTwoToneIcon from '@mui/icons-material/PlayForWorkTwoTone';\r\nimport db from \"../firebase/firebase\";\r\nimport \"../styles/AudioPlayer.css\";\r\n\r\nexport default memo(function AudioPlayer({\r\n  sender,\r\n  roomID,\r\n  audioUrl,\r\n  id,\r\n  setAudioID,\r\n  audioID,\r\n  animState,\r\n  audioPlayed,\r\n}) {\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [mediaLoaded, setMediaLoaded] = useState(false);\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [metadataLoaded, setMetadataLoaded] = useState(false);\r\n  const [error, setError] = useState(false);\r\n  const [sliderValue, setSliderValue] = useState(0);\r\n  const [sliderPlayedWidth, setSliderPlayedWidth] = useState(\"0%\");\r\n  const [duration, setDuration] = useState(\"\");\r\n  const totalDuration = useRef(\"\");\r\n  const audio = useRef(new Audio(audioUrl));\r\n  const interval = useRef();\r\n  const uploading = useRef(audioUrl === \"uploading\");\r\n\r\n  function play() {\r\n    audio.current.play();\r\n    if (!audioPlayed && !sender) {\r\n      db.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(id).set(\r\n        {\r\n          audioPlayed: true,\r\n        },\r\n        { merge: true }\r\n      );\r\n    }\r\n    if (audioID !== id) {\r\n      setAudioID(id);\r\n    }\r\n    interval.current = setInterval(seekUpdate, 50);\r\n    setIsPlaying(true);\r\n  }\r\n\r\n  function pause() {\r\n    audio.current.pause();\r\n    clearInterval(interval.current);\r\n    setIsPlaying(false);\r\n    setDuration(totalDuration.current);\r\n  }\r\n\r\n  function inputChange(e) {\r\n    const value = e.target.value;\r\n    if (mediaLoaded) {\r\n      const seekto = audio.current.duration * (value / 100);\r\n      audio.current.currentTime = seekto;\r\n      setSliderValue(value);\r\n      setSliderPlayedWidth(`${value - 5.7 * (value / 100)}%`);\r\n    }\r\n  }\r\n\r\n  function getCurrentTime() {\r\n    // Calculate the time left and the total duration\r\n    let currentMinutes = Math.floor(audio.current.currentTime / 60);\r\n    let currentSeconds = Math.floor(\r\n      audio.current.currentTime - currentMinutes * 60\r\n    );\r\n\r\n    // Add a zero to the single digit time values\r\n    if (currentSeconds < 10) {\r\n      currentSeconds = \"0\" + currentSeconds;\r\n    }\r\n    if (currentMinutes < 10) {\r\n      currentMinutes = \"0\" + currentMinutes;\r\n    }\r\n\r\n    // Display the updated duration\r\n    return currentMinutes + \":\" + currentSeconds;\r\n  }\r\n\r\n  function seekUpdate() {\r\n    let seekPosition = 0;\r\n    // Check if the current track duration is a legible number\r\n    if (!isNaN(audio.current.duration)) {\r\n      seekPosition = audio.current.currentTime * (100 / audio.current.duration);\r\n      setSliderValue(seekPosition);\r\n      setSliderPlayedWidth(seekPosition + \"%\");\r\n      setDuration(getCurrentTime());\r\n    }\r\n  }\r\n\r\n  function loadAudioAgain() {\r\n    audio.current.load();\r\n    setError(false);\r\n  }\r\n\r\n  function calculateMediaDuration(media) {\r\n    return new Promise((resolve, reject) => {\r\n      media.onloadedmetadata = function () {\r\n        // set the mediaElement.currentTime  to a high value beyond its real duration\r\n        media.currentTime = Number.MAX_SAFE_INTEGER;\r\n        // listen to time position change\r\n        media.ontimeupdate = function () {\r\n          media.ontimeupdate = function () {};\r\n          // setting player currentTime back to 0 can be buggy too, set it first to .1 sec\r\n          media.currentTime = 0.1;\r\n          media.currentTime = 0;\r\n          // media.duration should now have its correct value, return it...\r\n          resolve(media.duration);\r\n        };\r\n      };\r\n    });\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (uploading.current === true && audioUrl !== \"uploading\") {\r\n      audio.current = new Audio(audioUrl);\r\n      audio.current.load();\r\n      setLoaded(true);\r\n    } else if (uploading.current === false) {\r\n      setLoaded(true);\r\n    }\r\n  }, [audioUrl]);\r\n\r\n  useEffect(() => {\r\n    if (loaded) {\r\n      audio.current.addEventListener(\"error\", () => {\r\n        setError(true);\r\n      });\r\n      calculateMediaDuration(audio.current).then(() => {\r\n        setMetadataLoaded(true);\r\n      });\r\n    }\r\n  }, [loaded]);\r\n\r\n  useEffect(() => {\r\n    if (metadataLoaded) {\r\n      audio.current.addEventListener(\"canplaythrough\", async () => {\r\n        if (totalDuration.current === \"\") {\r\n          setMediaLoaded(true);\r\n          let durationMinutes = Math.floor(audio.current.duration / 60);\r\n          let durationSeconds = Math.floor(\r\n            audio.current.duration - durationMinutes * 60\r\n          );\r\n          // Add a zero to the single digit time values\r\n          if (durationSeconds < 10) {\r\n            durationSeconds = \"0\" + durationSeconds;\r\n          }\r\n          if (durationMinutes < 10) {\r\n            durationMinutes = \"0\" + durationMinutes;\r\n          }\r\n          // Display the updated duration\r\n          totalDuration.current = durationMinutes + \":\" + durationSeconds;\r\n          setDuration(totalDuration.current);\r\n        }\r\n      });\r\n      audio.current.addEventListener(\"ended\", () => {\r\n        clearInterval(interval.current);\r\n        setDuration(totalDuration.current);\r\n        setSliderValue(0);\r\n        setSliderPlayedWidth(\"0%\");\r\n        setIsPlaying(false);\r\n      });\r\n    }\r\n  }, [metadataLoaded]);\r\n\r\n  useEffect(() => {\r\n    if (animState === \"exiting\") {\r\n      audio.current.pause();\r\n    }\r\n  }, [animState]);\r\n\r\n  useEffect(() => {\r\n    if (audioID !== id) {\r\n      audio.current.pause();\r\n      setIsPlaying(false);\r\n    }\r\n  }, [audioID]);\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        className={`${sender ? \"audioplayer\" : \"audioplayer audioplayer2\"} ${\r\n          audioPlayed ? \"audioplayer__played\" : \"\"\r\n        }`}\r\n      >\r\n        {!mediaLoaded && !error ? (\r\n          <CircularProgress />\r\n        ) : isPlaying && !error ? (\r\n          <PauseCircleOutlineTwoToneIcon className=\"pause\" onClick={pause} />\r\n        ) : !isPlaying && !error ? (\r\n          <PlayCircleOutlineTwoToneIcon onClick={play} />\r\n        ) : (\r\n          <PlayForWorkTwoToneIcon onClick={loadAudioAgain} />\r\n        )}\r\n        <div>\r\n          <span\r\n            style={{\r\n              width: sliderPlayedWidth,\r\n            }}\r\n            className=\"audioplayer__slider--played\"\r\n          ></span>\r\n          <input\r\n            type=\"range\"\r\n            min=\"1\"\r\n            max=\"100\"\r\n            value={sliderValue}\r\n            onChange={inputChange}\r\n            class=\"audioplayer__slider\"\r\n          ></input>\r\n        </div>\r\n      </div>\r\n      <span className=\"chat__timestamp audioplayer__time\">{duration}</span>\r\n    </>\r\n  );\r\n});\r\n","export default __webpack_public_path__ + \"static/media/message_sent.3a970358.mp3\";","export default __webpack_public_path__ + \"static/media/message_received.644e27b6.mp3\";","import { useState, useEffect, useLayoutEffect, useRef, memo } from 'react';\r\nimport { IconButton, Avatar, MenuItem, Menu, CircularProgress } from '@mui/material';\r\nimport { TransitionGroup, Transition, CSSTransition } from \"react-transition-group\";\r\nimport AddPhotoAlternateTwoToneIcon from '@mui/icons-material/AddPhotoAlternateTwoTone';\r\nimport MoreVertTwoToneIcon from '@mui/icons-material/MoreVertTwoTone';\r\nimport DoneAllTwoToneIcon from '@mui/icons-material/DoneAllTwoTone';\r\nimport ArrowDownwardTwoToneIcon from '@mui/icons-material/ArrowDownwardTwoTone';\r\nimport ArrowBackTwoToneIcon from '@mui/icons-material/ArrowBackTwoTone';\r\nimport { useParams, useRouteMatch, useLocation, Link, Route, useHistory } from 'react-router-dom';\r\nimport db, { createTimestamp, fieldIncrement, storage, audioStorage } from \"../firebase/firebase\";\r\nimport { useStateValue } from '../states/StateProvider';\r\nimport MediaPreview from \"./MediaPreview\";\r\nimport ImagePreview from \"./ImagePreview\";\r\nimport ChatFooter from \"./ChatFooter\";\r\nimport Compressor from 'compressorjs';\r\nimport anime from 'animejs/lib/anime.es.js';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport AudioPlayer from \"./AudioPlayer.js\"\r\nimport '../styles/Chat.css';\r\nimport audio2 from \"../sounds/message_sent.mp3\";\r\nimport audio1 from \"../sounds/message_received.mp3\";\r\n\r\nfunction Chat({ animState, unreadMessages, b }) {\r\n    const [input, setInput] = useState('');\r\n    const { roomID } = useParams();\r\n    const location = useLocation()\r\n    const match = useRouteMatch();\r\n    const [{ dispatchMessages, user, roomsData, page }, dispatch, actionTypes] = useStateValue();\r\n    const [imagePreview, setImagePreview] = useState({})\r\n    const [messages, setMessages] = useState([]);\r\n    const [openMenu, setOpenMenu] = useState(null);\r\n    const [deleting, setDeleting] = useState(false);\r\n    const [focus, setFocus] = useState(false);\r\n    const [token, setToken] = useState('');\r\n    const [state, setState] = useState(location.state ? location.state : {});\r\n    const [seen, setSeen] = useState(false);\r\n    const [typing, setTyping] = useState(false);\r\n    const [src, setSRC] = useState('');\r\n    const [image, setImage] = useState(null);\r\n    const [writeState, setWriteState] = useState(0);\r\n    const [ratio, setRatio] = useState(false);\r\n    const [scrollArrow, setScrollArrow] = useState(false);\r\n    const [clientWidth, setClientWidth] = useState(null);\r\n    const [firstRender, setFirstRender] = useState(false);\r\n    const [sendAnim, setSendAnim] = useState(false);\r\n    const [limitReached, setLimitReached] = useState(Boolean(dispatchMessages[roomID]?.limitReached));\r\n    const history = useHistory();\r\n    const chatBodyRef = useRef();\r\n    const lastMessageRef = useRef();\r\n    const chatBodyContainer = useRef();\r\n    const chatAnim = useRef();\r\n    const mediaPreview = useRef();\r\n    const prevMessages = useRef([])\r\n    const limit = useRef(30);\r\n    const prevScrollHeight = useRef(null);\r\n    const [audioID, setAudioID] = useState(null);\r\n    const paginating = useRef(null);\r\n    const paginating2 = useRef(null);\r\n    const [paginateLoader, setPaginateLoader] = useState(false);\r\n    const messageSentAudio = new Audio(audio2);\r\n    const messageReceivedAudio = new Audio(audio1);\r\n    const mediaSnap = useRef([]);\r\n    const mediaChecked = useRef(false);\r\n\r\n    //console.log(match)\r\n    const change = (e) => {\r\n        clearTimeout(writeState);\r\n        setInput(e.target.value);\r\n        if (state?.userID) {\r\n            db.collection(\"rooms\").doc(roomID).set({\r\n                [user.uid]: true,\r\n            }, { merge: true }).then(() => {\r\n                setWriteState(setTimeout(() => {\r\n                    db.collection(\"rooms\").doc(roomID).set({\r\n                        [user.uid]: false,\r\n                    }, { merge: true });\r\n                }, 1000));\r\n            });\r\n        }; \r\n    };\r\n\r\n    const clickImagePreview = (event, src, ratio) => {\r\n        const target = event.target;\r\n        const node = target.parentNode.parentNode;\r\n        const obj = node.getBoundingClientRect();\r\n        setImagePreview({\r\n    \t\tratio: ratio,\r\n            top: page.transform === \"scale(1)\" ? obj.top :  obj.top / (window.innerHeight / page.height),\r\n            left: page.transform === \"scale(1)\" ? obj.left : obj.left / (window.innerWidth / page.width),\r\n            width: node.offsetWidth,\r\n            height: node.offsetHeight,\r\n            imgW: target.offsetWidth,\r\n            imgH: target.offsetHeight,\r\n            src,\r\n        })\r\n    }\r\n\r\n    const close = () => {\r\n        mediaPreview.current.style.animation = \"opacity-out 300ms ease forwards\";\r\n        setTimeout(() => {\r\n            setImage(null);\r\n            setSRC(\"\");\r\n        }, 310);\r\n    };\r\n\r\n    const handleFile = event => {\r\n        if (window.navigator.onLine) {\r\n            if (event.target.files[0]) {\r\n                var reader = new FileReader();\r\n                reader.onload = function () {\r\n                    setSRC(reader.result)\r\n                }\r\n                reader.readAsDataURL(event.target.files[0]);\r\n                setImage(event.target.files[0])\r\n            };\r\n        } else {\r\n            alert(\"No access to internet !!!\");\r\n        };\r\n    };\r\n    //window\r\n    const scrollChatBody = () => {\r\n        const nodeArr = Array.from(document.querySelectorAll('.chat__message'));\r\n        const height =  outerHeight(nodeArr[nodeArr.length - 2]) + outerHeight(nodeArr[nodeArr.length - 3]) + outerHeight(nodeArr[nodeArr.length - 4]);\r\n        const lastMHeight = height < page.height / 2 ? height : page.height / 2;\r\n        if (chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight === 0) {\r\n            setTimeout(() => {\r\n                if (chatBodyRef.current) {\r\n                \tchatBodyRef.current.style.opacity = \"1\";\r\n                }\r\n                setFirstRender(true)\r\n            }, animState === \"entering\" ? 350 : 50);\r\n            setTimeout(() => {\r\n                const node = document.querySelector(\".chat .chat__lastMessage\");\r\n                if (node) {\r\n                    node.style.animation = \"none\";\r\n                    node.style.opacity = \"1\";\r\n                }\r\n            }, 50)\r\n        } else if (chatBodyContainer.current.scrollTop + outerHeight(nodeArr[nodeArr.length - 1]) >=\r\n            (chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight - lastMHeight)\r\n            && messages[messages.length - 1].uid !== user.uid) {\r\n            if (chatBodyContainer.current.scrollTop !== chatBodyContainer.current.scrollHeight) {\r\n                //console.log(\"scrolling down 1\");\r\n                setSendAnim(true);\r\n                anime({\r\n                    targets: chatBodyContainer.current,\r\n                    scrollTop: chatBodyContainer.current.scrollHeight,\r\n                    duration: 800,\r\n                    easing: \"linear\",\r\n                    complete: function() {\r\n                        setSendAnim(false);\r\n                    }\r\n                });   \r\n            };\r\n        } else if (messages[messages.length - 1].uid === user.uid) {\r\n            if (chatBodyContainer.current.scrollTop !== chatBodyContainer.current.scrollHeight) {\r\n                //console.log(\"scrolling down 2\");\r\n                setSendAnim(true);\r\n                anime({\r\n                    targets: chatBodyContainer.current,\r\n                    scrollTop: chatBodyContainer.current.scrollHeight,\r\n                    duration: 800,\r\n                    easing: \"linear\",\r\n                    complete: function() {\r\n                        setSendAnim(false);\r\n                    }\r\n                });\r\n            }\r\n\r\n        } else {\r\n            setScrollArrow(true);\r\n        }\r\n    }\r\n\r\n    function outerHeight(el) {\r\n      if (el) {\r\n        var height = el.offsetHeight;\r\n          var style = getComputedStyle(el);\r\n\r\n          height += parseInt(style.marginTop) + parseInt(style.marginBottom);\r\n          return height;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    const sendMessage = async event => {\r\n        event.preventDefault();\r\n        if (focus) {\r\n            document.querySelector('.chat__footer > form > input').focus();\r\n        }\r\n        if (input !== \"\" || (input === \"\" && image)) {\r\n            const inputText = input;\r\n            const imageToUpload = image\r\n            if (imageToUpload) {\r\n                close();\r\n            }\r\n            setInput(\"\");\r\n            const roomInfo = {\r\n                lastMessage: imageToUpload ? {\r\n                    message: inputText,\r\n                    audio: false,\r\n                } : inputText,\r\n                seen: false,\r\n            }\r\n            db.collection(\"rooms\").doc(roomID).set(roomInfo, { merge: true });\r\n            var split, imageName;\r\n            if (imageToUpload) {\r\n                split = imageToUpload.name.split(\".\");\r\n                imageName = split[0] + uuidv4() + \".\" + split[1];\r\n            }\r\n            const messageToSend = imageToUpload ? {\r\n                name: user.displayName,\r\n                message: input,\r\n                uid: user.uid,\r\n                timestamp: createTimestamp(),\r\n                time: new Date().toUTCString(),\r\n                imageUrl: \"uploading\",\r\n                imageName: imageName,\r\n                ratio: ratio\r\n            } : {\r\n                name: user.displayName,\r\n                message: input,\r\n                uid: user.uid,\r\n                timestamp: createTimestamp(),\r\n                time: new Date().toUTCString(),\r\n            }\r\n            if (state.userID) {\r\n                db.collection(\"users\").doc(state.userID).collection(\"chats\").doc(roomID).set({\r\n                    timestamp: createTimestamp(),\r\n                    photoURL: user.photoURL ? user.photoURL : null,\r\n                    name: user.displayName,\r\n                    userID: user.uid,\r\n                    unreadMessages: fieldIncrement(1),\r\n                }, { merge: true });\r\n                db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\r\n                    timestamp: createTimestamp(),\r\n                    photoURL: state.photoURL ? state.photoURL : null,\r\n                    name: state.name,\r\n                    userID: state.userID\r\n                }, { merge: true });\r\n                if (token !== \"\" && !imageToUpload) {\r\n                    db.collection(\"notifications\").add({\r\n                        userID: user.uid,\r\n                        title: user.displayName,\r\n                        body: inputText,\r\n                        photoURL: user.photoURL,\r\n                        token: token,\r\n                    });\r\n                };\r\n            } else {\r\n                db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\r\n                    timestamp: createTimestamp(),\r\n                    photoURL: state.photoURL ? state.photoURL : null,\r\n                    name: state.name,\r\n                });\r\n            };\r\n            const doc = await db.collection(\"rooms\").doc(roomID).collection(\"messages\").add(messageToSend);\r\n            if (imageToUpload) {\r\n                new Compressor(imageToUpload, { quality: 0.8, maxWidth: 1920, async success(result) {\r\n                    setSRC(\"\");\r\n                    setImage(null);\r\n                    await storage.child(imageName).put(result);\r\n                    const url = await storage.child(imageName).getDownloadURL();\r\n                    db.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(doc.id).update({\r\n                        imageUrl: url\r\n                    });\r\n                    if (state.userID && token !== \"\") db.collection(\"notifications\").add({\r\n                        userID: user.uid,\r\n                        title: user.displayName,\r\n                        body: inputText,\r\n                        photoURL: user.photoURL,\r\n                        token: token,\r\n                        image: url\r\n                    });\r\n                }});\r\n            };\r\n        };\r\n    };\r\n\r\n    const deleteRoom = async () => {\r\n\tif (window.navigator.onLine) {\r\n            setOpenMenu(false);\r\n            setDeleting(true);\r\n            try {\r\n                const room = db.collection(\"rooms\").doc(roomID);\r\n                const fetchedMessages = await room.collection(\"messages\").get();\r\n                const fetchedAudios = [];\r\n                const fecthedImages = [];\r\n                fetchedMessages.docs.forEach(doc => {\r\n                    if (doc.data().audioName) {\r\n                        fetchedAudios.push(doc.data().audioName);\r\n                    } else if (doc.data().imageName) {\r\n                        fecthedImages.push(doc.data().imageName);\r\n                    }\r\n                });\r\n                var usersChats = [];\r\n                if (state.userID) {\r\n                    usersChats = [state.userID, user.uid];\r\n                } else {\r\n                    usersChats = [...new Set(fetchedMessages.docs.map(cur => cur.data().uid))];\r\n                };\r\n                await Promise.all([\r\n                    ...fetchedMessages.docs.map(doc => doc.ref.delete()),\r\n                    ...fecthedImages.map(img => storage.child(img).delete()),\r\n                    ...fetchedAudios.map(aud => audioStorage.child(aud).delete()),\r\n                    ...usersChats.map(userChat => db.collection(\"users\").doc(userChat).collection(\"chats\").doc(roomID).delete()),\r\n                    room.delete()\r\n                ]);\r\n                page.width <= 760 ? history.goBack() : history.replace(\"/chats\");\r\n            } catch(e) {\r\n                console.log(e.message);\r\n                page.width <= 760 ? history.goBack() : history.replace(\"/chats\");\r\n            };\r\n        } else {\r\n            alert(\"No access to internet !!!\");\r\n        };\r\n    };\r\n\r\n    const handleFocus = () => {\r\n        if (chatBodyContainer.current.scrollTop > chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight - 120) {\r\n            chatBodyContainer.current.scrollTop = chatBodyContainer.current.scrollHeight;\r\n        };\r\n    };\r\n\r\n    function fetchMessages(update) {\r\n        const ref = db.collection(\"rooms\").doc(roomID).collection(\"messages\").orderBy(\"timestamp\", \"desc\");\r\n        if (update) {\r\n            b.current[roomID] = ref.limit(5).onSnapshot(snapshot => {\r\n                const newMessages = snapshot.docs.map(doc => {\r\n                    const data = doc.data();\r\n                    const time = data.time ? data.time : new Date(data.timestamp?.toDate()).toUTCString()\r\n                    return {\r\n                        ...data,\r\n                        timestamp: time,\r\n                        id: doc.id,\r\n                    }\r\n                });\r\n                newMessages.reverse();\r\n                dispatch({\r\n                    type: actionTypes.SET_MESSAGES,\r\n                    id: roomID,\r\n                    messages: newMessages,\r\n                    update\r\n                });\r\n            });\r\n        } else {\r\n            ref.limit(limit.current).get().then(docs => {\r\n                const newMessages = [];\r\n                docs.forEach(doc => {\r\n                    const data = doc.data();\r\n                    const time = data.time ? data.time : new Date(data.timestamp?.toDate()).toUTCString()\r\n                    newMessages.push({\r\n                        ...data,\r\n                        timestamp: time,\r\n                        id: doc.id,\r\n                    });\r\n                });\r\n                newMessages.reverse();\r\n                dispatch({\r\n                    type: actionTypes.SET_MESSAGES,\r\n                    id: roomID,\r\n                    messages: newMessages,\r\n                    update\r\n                });\r\n            });\r\n        };\r\n    }\r\n\r\n    function paginate() {\r\n        if (chatBodyContainer.current?.scrollTop === 0 && !limitReached && !paginating.current) {\r\n            setPaginateLoader(true);\r\n            prevScrollHeight.current = chatBodyContainer.current.scrollHeight;\r\n            paginating.current = true;\r\n            paginating2.current = true;\r\n            limit.current = messages.length + limit.current;\r\n            fetchMessages(false);\r\n        } else if (paginating2.current) {\r\n        \tprevScrollHeight.current = chatBodyContainer.current.scrollHeight - chatBodyContainer.current.scrollTop;\r\n        };\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (messages.length > 0 && !deleting) {\r\n            if (messages[messages.length - 1].id !== prevMessages.current[prevMessages.current?.length - 1]?.id && dispatchMessages[roomID]?.audio) {\r\n                if (messages[messages.length - 1].uid !== user.uid && !paginating2.current && (messages[messages.length - 1].imageUrl === \"uploading\" || !messages[messages.length - 1].imageUrl)) {\r\n                    messageReceivedAudio.play();\r\n                } else if (messages[messages.length - 1].uid === user.uid && !paginating2.current && (messages[messages.length - 1].imageUrl === \"uploading\" || !messages[messages.length - 1].imageUrl) && (messages[messages.length - 1].audioUrl === \"uploading\" || !messages[messages.length - 1].audioUrl)) {\r\n                    messageSentAudio.play();\r\n                };\r\n            };\r\n\r\n        };\r\n    }, [messages, deleting, dispatchMessages[roomID]]);\r\n\r\n    useEffect(() => {\r\n        if (firstRender && !limitReached) {\r\n            chatBodyContainer.current.addEventListener(\"scroll\", paginate);\r\n        };\r\n        const clean = chatBodyContainer.current;\r\n        return () => {\r\n            clean.removeEventListener(\"scroll\", paginate);  \r\n        };\r\n    }, [firstRender, limitReached]);\r\n\r\n\r\n    useEffect(() => {\r\n        if (limitReached !== dispatchMessages[roomID]?.limitReached) {\r\n            //console.log(\"setting limit reached: \", Boolean(dispatchMessages[roomID]?.limitReached));\r\n            setLimitReached(Boolean(dispatchMessages[roomID]?.limitReached));\r\n        } \r\n    }, [dispatchMessages[roomID]], limitReached);\r\n\r\n    useLayoutEffect(() => {\r\n        //console.log(\"paginating: \", paginating.current)\r\n        if (messages.length > 0 && paginating.current) {\r\n            if (paginating.current && messages.length > prevMessages.current?.length) {\r\n                chatBodyContainer.current.scrollTop = chatBodyContainer.current.scrollHeight - prevScrollHeight.current;\r\n                paginating.current = false;\r\n                setPaginateLoader(false);\r\n            };\r\n        };\r\n    }, [messages]);\r\n\r\n    useEffect(() => {\r\n        if (messages.length > 0) {\r\n            if (!firstRender && chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight !== 0) {\r\n                chatBodyContainer.current.scrollTop = chatBodyContainer.current.scrollHeight;\r\n                setTimeout(() => {\r\n                    const node = document.querySelector(\".chat .chat__lastMessage\");\r\n                    if (node) {\r\n                        node.style.animation = \"none\";\r\n                        node.style.opacity = \"1\";\r\n                    };\r\n                    setTimeout(() => {\r\n                        setFirstRender(true);\r\n                    }, 200);\r\n                }, 50); \r\n            } else {\r\n                //console.log(\"messages: \", messages);\r\n                //console.log(\"previous messages: \", prevMessages.current);\r\n                //console.log(\"paginating2: \", paginating2.current)\r\n                if (!paginating2.current) {\r\n                    scrollChatBody();\r\n                };\r\n            };\r\n        }\r\n    }, [messages]);\r\n\r\n    function listenToImg(docID) {\r\n        return db.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(docID).onSnapshot(doc => {\r\n            //console.log(\"image snap set\");\r\n            //console.log(\"image data: \", doc.data());\r\n            const {imageUrl} = doc.data();\r\n            if (imageUrl !== \"uploading\") {\r\n                //console.log(\"dispatching the image\");\r\n                dispatch({\r\n                    type: \"update_media\",\r\n                    roomID: roomID,\r\n                    id: docID,\r\n                    data: {imageUrl}\r\n                });\r\n                //console.log(\"unsubscribing from image snap: \", docID);\r\n                mediaSnap.current = mediaSnap.current.filter(cur => {\r\n                    if (cur.id !== docID) {\r\n                        return true;\r\n                    }\r\n                    cur.snap();\r\n                    return false;\r\n                });\r\n            };\r\n        });\r\n    };\r\n\r\n    function listenToAudio(docID) {\r\n        //console.log(\"listen to audio function\")\r\n        const s = db.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(docID).onSnapshot(doc => {\r\n            //console.log(\"audio snap set\");\r\n            //console.log(\"audio data: \", doc.data());\r\n            const {audioUrl, audioPlayed} = doc.data();\r\n            if (audioUrl !== \"uploading\" || audioPlayed === true) {\r\n                //console.log(\"dispatching audio\");\r\n                dispatch({\r\n                    type: \"update_media\",\r\n                    roomID: roomID,\r\n                    id: docID,\r\n                    data: {\r\n                        audioUrl,\r\n                        audioPlayed\r\n                    }\r\n                });\r\n            };\r\n            if (audioUrl !== \"uploading\" && audioPlayed === true) {\r\n                //console.log(\"unsubscribing from audio snap: \", docID);\r\n                mediaSnap.current = mediaSnap.current.filter(cur => {\r\n                    if (cur.id !== docID) {\r\n                        return true;\r\n                    };\r\n                    cur.snap();\r\n                    return false;\r\n                });\r\n            }\r\n        });\r\n        return s;\r\n    };\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            dispatch({type: \"set_audio_false\", id: roomID});\r\n        };\r\n    }, [roomID]);\r\n\r\n    useEffect(() => {\r\n        if (messages.length > 0 && firstRender && !mediaChecked.current) {\r\n            //console.log(\"checking media\");\r\n            messages.forEach(cur => {\r\n                if (cur.imageUrl === \"uploading\") {\r\n                    //console.log(\"listening to an image\");\r\n                    const x = listenToImg(cur.id);\r\n                    mediaSnap.current.push({\r\n                        snap: x,\r\n                        id: cur.id,\r\n                    });\r\n                } else if (cur.audioUrl === \"uploading\" || cur.audioPlayed === false) {\r\n                    //console.log(\"listening to audio\");\r\n                    const x = listenToAudio(cur.id);\r\n                    mediaSnap.current.push({\r\n                        snap: x,\r\n                        id: cur.id,\r\n                    });\r\n                };\r\n            });\r\n            mediaChecked.current = true;\r\n        } else if (messages.length > prevMessages.current.length && firstRender && mediaChecked.current) {\r\n            //console.log(\"checking updates\")\r\n            let init = 0;\r\n            let stop = messages.length - prevMessages.length;\r\n            if (prevMessages.current[0]?.id === messages[0].id) {\r\n\t            init = prevMessages.current.length;\r\n\t            stop = messages.length;\r\n            }\r\n            for (var i = init; i < stop; i++) {\r\n                if (messages[i].imageUrl === \"uploading\") {\r\n                    //console.log(\"listening to an image\");\r\n                    const x = listenToImg(messages[i].id);\r\n                    mediaSnap.current.push({\r\n                        snap: x,\r\n                        id: messages[i].id,\r\n                    });\r\n                } else if (messages[i].audioUrl === \"uploading\" || messages[i].audioPlayed === false) {\r\n                    //console.log(\"listening to audio\");\r\n                    const x = listenToAudio(messages[i].id);\r\n                    mediaSnap.current.push({\r\n                        snap: x,\r\n                        id: messages[i].id,\r\n                    });\r\n                }; \r\n            };\r\n        };\r\n    }, [messages, firstRender]);\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            //console.log(\"cleaning media snap\");\r\n            mediaSnap.current.forEach(cur => cur.snap());\r\n            setFirstRender(false)\r\n        };\r\n    }, [roomID]);\r\n\r\n    useEffect(() => {\r\n        paginating2.current = paginating.current;\r\n        prevMessages.current = [...messages];\r\n    }, [messages]);\r\n\r\n    useEffect(() => {\r\n        if (roomID && !deleting) {\r\n            if (b.current[roomID]) {\r\n                //console.log(\"snapshot listener already exists\");\r\n                b.current[roomID]();\r\n            }\r\n            //console.log(\"first message from fetch effect: \", dispatchMessages[roomID]?.firstMessageID);\r\n            if (dispatchMessages[roomID]?.firstMessageID) {\r\n                fetchMessages(true);\r\n            } else {\r\n                db.collection(\"rooms\").doc(roomID).collection(\"messages\").orderBy(\"timestamp\", \"asc\").limit(1).get().then(docs => {\r\n                        //console.log(\"doc: \", docs);\r\n                        if (docs.empty) {\r\n                            dispatch({\r\n                                type: \"set_firstMessage\",\r\n                                id: roomID,\r\n                                firstMessageID: \"no id\",\r\n                            }); \r\n                        } else {\r\n                            docs.forEach(doc => {\r\n                                //console.log(\"doc.exists: \", doc.exists);\r\n                                //console.log(\"first document id: \", doc.id);\r\n                                //console.log(\"first document data: \", doc.data());\r\n                                dispatch({\r\n                                    type: \"set_firstMessage\",\r\n                                    id: roomID,\r\n                                    firstMessageID: doc.id,\r\n                                });\r\n                            });       \r\n                        };\r\n                    fetchMessages(false);\r\n                    fetchMessages(true);\r\n                });\r\n            };\r\n        };\r\n    }, [roomID, deleting]);\r\n\r\n    useEffect(() => {\r\n        if (src !== \"\") {\r\n            const width = document.querySelector('.mediaPreview img').clientWidth;\r\n            const height = document.querySelector('.mediaPreview img').clientHeight;\r\n            setRatio(height / width);\r\n        }\r\n    }, [src])\r\n\r\n    useEffect(() => {\r\n        setClientWidth(document.querySelector('.chat__body--container').clientWidth)\r\n    }, []);\r\n    //window\r\n    useEffect(() => {\r\n        if (animState === \"entering\" && page.width <= 760) {\r\n            setTimeout(() => {\r\n                document.querySelector(\".chat\").classList.add('chat-animate');\r\n            }, 0)\r\n        } else if (animState === \"entered\" && state?.name && page.width <= 760) {\r\n            setTimeout(() => {\r\n                document.querySelector('.sidebar').classList.remove('side');\r\n            }, 50)\r\n        } else if (animState === \"exiting\" && page.width <= 760 ) {\r\n            setTimeout(() => {\r\n                document.querySelector(\".chat\").classList.remove('chat-animate');\r\n                setTimeout(() => {\r\n                    document.querySelector('.sidebar').classList.add('side');\r\n                }, 10)\r\n            }, 0)\r\n        }\r\n    }, [animState])\r\n\r\n    useEffect(() => {\r\n        if (!location.state && roomID) {\r\n            const userID = roomID?.replace(user.uid, \"\");\r\n            db.collection(\"users\").doc(userID).get().then(doc => {\r\n                const data = doc.data();\r\n                setState(data?.name ? {\r\n                    name: data.name,\r\n                    photoURL: data.photoURL,\r\n                    userID,\r\n                } : {\r\n                        userID,\r\n                    })\r\n            })\r\n        } else {\r\n            setState(location.state)\r\n        }\r\n    }, [location.state, roomID])\r\n\r\n    useEffect(() => {\r\n        if (state?.userID) {\r\n            db.collection(\"users\").doc(state.userID).onSnapshot(doc => {\r\n                if (doc.data()?.token) {\r\n                    setToken(doc.data().token);\r\n                };\r\n            });\r\n        };\r\n    }, [state]);\r\n\r\n    useEffect(() => {\r\n        if (roomID && state?.userID) {\r\n            var h = db.collection(\"rooms\").doc(roomID).onSnapshot(snap => {\r\n                if (snap.data()) {\r\n                    setTyping(snap.data()[state.userID]);\r\n                }\r\n            })\r\n        }\r\n\r\n        return () => {\r\n            if (h) h();\r\n        }\r\n    }, [roomID, state])\r\n\r\n    useEffect(() => {\r\n        if (roomID) {\r\n            var z = db.collection(\"rooms\").doc(roomID).onSnapshot(snap => {\r\n                setSeen(snap.data()?.seen);\r\n            })\r\n        }\r\n\r\n        return () => {\r\n            if (z) {\r\n                z();\r\n            }\r\n        }\r\n    }, [roomID])\r\n\r\n    //setSender\r\n    //window\r\n    useEffect(() => {\r\n        var a = () => {\r\n            const nodeArr = Array.from(document.querySelectorAll('.chat__message'));\r\n            const height = outerHeight(nodeArr[nodeArr.length - 1]) + outerHeight(nodeArr[nodeArr.length - 2]) + outerHeight(nodeArr[nodeArr.length - 3]) + outerHeight(nodeArr[nodeArr.length - 4]);\r\n            const lastMHeight = height < page.height / 2 ? height : page.height / 2;\r\n            if (chatBodyContainer.current?.scrollTop <= (chatBodyContainer.current?.scrollHeight - chatBodyContainer.current?.offsetHeight - lastMHeight)) {\r\n                setScrollArrow(true)\r\n            } else {\r\n                setScrollArrow(false)\r\n            }\r\n            const scrollTop = Math.round(chatBodyContainer.current.scrollTop);\r\n            const scrollHeight = chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight;\r\n            if ((scrollTop === scrollHeight || scrollTop + 1 === scrollHeight || scrollTop - 1 === scrollHeight) && (chatBodyRef.current.style.opacity === \"0\" || chatBodyRef.current.style.opacity === \"\")) {\r\n                setTimeout(() => {\r\n                \tif (chatBodyRef.current) {\r\n                \t\tchatBodyRef.current.style.opacity = \"1\";\r\n                \t}\r\n                }, animState === \"entering\" ? 350 : 50)\r\n            }\r\n            if (messages.length > 0) {\r\n                if (chatBodyContainer.current.scrollTop > chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight - 180\r\n                    && state.userID && !seen && messages[messages.length - 1].uid !== user.uid) {\r\n                    console.log(\"setting seen true with event\");\r\n                    db.collection(\"rooms\").doc(roomID).set({\r\n                        seen: true,\r\n                    }, { merge: true });\r\n                }\r\n                if (chatBodyContainer.current.scrollTop > chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight - 180\r\n                    && state.userID) {\r\n                    db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\r\n                        unreadMessages: 0,\r\n                    }, { merge: true });\r\n                };\r\n            };\r\n        };\r\n        chatBodyContainer.current.addEventListener('scroll', a);\r\n        const ref = chatBodyContainer.current;\r\n\r\n        return () => {\r\n            ref.removeEventListener(\"scroll\", a)\r\n        }\r\n    }, [messages, state, user.uid, roomID, seen]);\r\n\r\n\r\n    //setting seen and unreadMessages when chat is unscrollable\r\n    useEffect(() => {\r\n        if (messages.length > 0) {\r\n            if (chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight === 0 && messages[messages.length - 1].uid !== user.uid) {\r\n                db.collection(\"rooms\").doc(roomID).set({\r\n                    seen: true,\r\n                }, { merge: true });\r\n            };\r\n        };\r\n    },[messages]);\r\n\r\n    useEffect(() => {\r\n\t\tif (messages.length > 0) {\r\n            if (chatBodyContainer.current.scrollHeight - chatBodyContainer.current.offsetHeight === 0\r\n                && state.userID) {\r\n                db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\r\n                    unreadMessages: 0,\r\n                }, { merge: true });\r\n            }\r\n        }\r\n    }, [messages, state]);\r\n\r\n    useEffect(() => {\r\n        if (dispatchMessages[roomID]?.messages) {\r\n            setMessages(dispatchMessages[roomID].messages);\r\n        };\r\n    }, [dispatchMessages[roomID]]);\r\n\r\n    \r\n    //window\r\n    const widthRatio = 0.7;\r\n    \r\n    return (\r\n        <>\r\n        <div style={!roomID ? { display: \"none\"} : {}} ref={chatAnim} className=\"chat\">\r\n            <div style={{\r\n                height: page.height,\r\n            }} className=\"chat__background\">\r\n\r\n            </div>\r\n            <div className=\"chat__header\">\r\n                {page.width <= 760 ?\r\n                    <IconButton onClick={() => setTimeout(() => history.goBack(), 150)}>\r\n                        <ArrowBackTwoToneIcon />\r\n                        <div className=\"avatar__container\">\r\n                            <Avatar src={state?.photoURL} />\r\n                            {roomsData[roomID]?.onlineState === \"online\" ? <div className=\"online\"></div> : null}  \r\n                        </div>\r\n                        \r\n                    </IconButton>\r\n                : \r\n                    <div className=\"avatar__container\">\r\n                        <Avatar src={state?.photoURL} />\r\n                        {roomsData[roomID]?.onlineState === \"online\" ? <div className=\"online\"></div> : null} \r\n                    </div>\r\n                }\r\n                <div className=\"chat__header--info\">\r\n                    <h3 style={page.width <= 760 ? {width: page.width - 165 } : {}}>{state?.name} </h3>\r\n                    <p style={page.width <= 760 ? {width: page.width - 165 } : {}}>{typing === \"recording\" ? \"Recording ...\" : typing ? \"Typing ...\" : messages?.length > 0 ? \"Seen at \" + messages[messages.length - 1]?.timestamp : \"\"} </p>\r\n                </div>\r\n\r\n                <div className=\"chat__header--right\">\r\n                    <input id=\"attach-media\" style={{ display: \"none\" }} accept=\"image/*\" type=\"file\" onChange={handleFile} />\r\n                    <IconButton>\r\n                        <label style={{ cursor: \"pointer\", height: 24 }} htmlFor=\"attach-media\">\r\n                            <AddPhotoAlternateTwoToneIcon />\r\n                        </label>\r\n                    </IconButton>\r\n\r\n                    <IconButton aria-controls=\"menu\" aria-haspopup=\"true\" onClick={event => setOpenMenu(event.currentTarget)}>\r\n                        <MoreVertTwoToneIcon />\r\n                    </IconButton>\r\n                    <Menu\r\n                        anchorEl={openMenu}\r\n                        id={\"menu\"}\r\n                        open={Boolean(openMenu)}\r\n                        onClose={() => setOpenMenu(null)}\r\n                        keepMounted\r\n                    >\r\n                        <MenuItem onClick={deleteRoom}>Delete Room</MenuItem>\r\n                    </Menu>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"chat__body--container\" ref={chatBodyContainer}>\r\n                <div className=\"chat__body\" ref={chatBodyRef}>\r\n                    <div \r\n                        className=\"loader__container paginateLoader\"\r\n                        style={{\r\n                            height: !limitReached ? 70 : 30,\r\n                        }}\r\n                    >\r\n                        {paginateLoader && !limitReached ? <CircularProgress /> : null}\r\n                    </div>\r\n                    {messages.map((message, i, messageArr) => {\r\n                        const style = message.imageUrl ? {\r\n                            marginBottom: !messageArr[i + 1] ? 0 : message.uid !== messageArr[i + 1].uid ? 30 : 8,\r\n                            width: clientWidth * widthRatio + 20,\r\n                            maxWidth: 320,\r\n                        } : {\r\n                                marginBottom: !messageArr[i + 1] ? 0 : message.uid !== messageArr[i + 1].uid ? 30 : 8,\r\n                                width: clientWidth * widthRatio + 20,\r\n                                maxWidth: 320,\r\n                            }  \r\n                        return (\r\n                            <div style={style} ref={i === messages.length - 1 && !(seen && messages[messages.length - 1].uid === user.uid) ? lastMessageRef : null} key={message.id} className={`chat__message ${message.uid === user.uid && \"chat__reciever\"} ${i === messages.length - 1 ? \"chat__lastMessage\" : \"\"}`}>\r\n                                <span className=\"chat__name\">\r\n                                    {message.name}\r\n                                </span>\r\n                                {message.imageUrl === \"uploading\" ?\r\n                                    <div\r\n                                        style={{\r\n                                            width: clientWidth * widthRatio,\r\n                                            height: message.ratio <= 1 ?\r\n                                                    clientWidth * widthRatio > 300 ?\r\n                                                        300 * message.ratio : clientWidth * widthRatio * message.ratio :\r\n                                                    clientWidth * widthRatio < 300 ? clientWidth * widthRatio : 300,\r\n                                        }}\r\n                                        className=\"image-container\"\r\n                                    >\r\n                                        <div className=\"image__container--loader\">\r\n                                            <CircularProgress style={{ width: page.width <= 760 ? 40 : 80, height: page.width <= 760 ? 40 : 80 }} />\r\n                                        </div>\r\n                                    </div>\r\n                                    : message.imageUrl ?\r\n                                        <div                                       \t\r\n                                            className=\"image-container\"\r\n                                            style={{\r\n                                                width: clientWidth * widthRatio,\r\n                                                height: message.ratio <= 1 ?\r\n                                                        clientWidth * widthRatio > 300 ?\r\n                                                            300 * message.ratio : clientWidth * widthRatio * message.ratio :\r\n                                                        clientWidth * widthRatio < 300 ? clientWidth * widthRatio : 300,\r\n                                            }}\r\n                                        >\r\n                                            <Link  to={{\r\n                                            \tpathname: match.url + \"/image\",\r\n                                            \tstate: state,\r\n                                            }}>\r\n                                                <img onClick={(e) => clickImagePreview(e, message.imageUrl, message.ratio)} src={message.imageUrl} alt=\"\" />\r\n                                            </Link>\r\n                                        </div>\r\n                                        : null}\r\n                                {message.audioName ?\r\n                                    <AudioPlayer sender={message.uid === user.uid} roomID={roomID} animState={animState} setAudioID={setAudioID} audioID={audioID} id={message.id} audioUrl={message.audioUrl} audioPlayed={message.audioPlayed} />\r\n                                : <span className=\"chat__message--message\">{message.message}</span>}\r\n                                <span className=\"chat__timestamp\">\r\n                                    {message.timestamp}\r\n                                </span>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                    {messages.length > 0 ?\r\n                        <CSSTransition\r\n                            in={seen && messages[messages.length - 1].uid === user.uid}\r\n                            timeout={200}\r\n                            classNames=\"seen-animate\"\r\n                            appear={true}\r\n                        >\r\n                            <p className=\"seen\" >\r\n                                <p><span>Seen <DoneAllTwoToneIcon /></span></p>\r\n                            </p>\r\n                        </CSSTransition>\r\n                    : null}\r\n                </div>\r\n            </div>\r\n            {src !== \"\" ? <MediaPreview close={close} mediaPreview={mediaPreview} setSRC={setSRC} setImage={setImage} imageSRC={src} /> : null}\r\n\r\n            <ChatFooter \r\n                input={input} \r\n                handleFocus={handleFocus} \r\n                change={change} \r\n                sendMessage={sendMessage} \r\n                setFocus={setFocus}\r\n                image={image}\r\n                focus={focus}\r\n                state={state}\r\n                token={token}\r\n                roomID={roomID} \r\n                setAudioID={setAudioID}\r\n            />\r\n            <div></div>\r\n            \t\t\t\t\r\n            <CSSTransition\r\n                in={firstRender && scrollArrow && !sendAnim}\r\n                classNames=\"scroll\"\r\n                timeout={310}\r\n                unmountOnExit\r\n            >\r\n                <div className=\"scroll\" onClick={() => \r\n                    anime({\r\n                        targets: chatBodyContainer.current,\r\n                        scrollTop: chatBodyContainer.current.scrollHeight,\r\n                        duration: 1000,\r\n                        easing: \"linear\",\r\n                    })}\r\n                >\r\n                    <ArrowDownwardTwoToneIcon style={{\r\n                        width: 22,\r\n                        height: 22,\r\n                        color: \"black\",\r\n                    }} />\r\n                    {unreadMessages ? <div><span>{unreadMessages}</span></div> : null}\r\n                </div>\r\n            </CSSTransition>\r\n            {deleting ?\r\n                <div className=\"chat__deleting\">\r\n                    <CircularProgress />\r\n                </div> : null\r\n            }\r\n        </div>\r\n        <TransitionGroup component={null}>\r\n            <Transition\r\n                timeout={{\r\n                    appear: 310,\r\n                    enter: 310,\r\n                    exit: 410,\r\n                }}\r\n                classNames=\"page\"\r\n                key={location.pathname}\r\n            >\r\n                {animState => (\r\n                    <Route path={match.url + \"/image\"} location={location}>\r\n                        <ImagePreview\r\n                            imagePreview={imagePreview}\r\n                            animState={animState}\r\n                        />\r\n                    </Route>\r\n                )}  \r\n            </Transition>\r\n        </TransitionGroup>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default memo(Chat);\r\n","export default __webpack_public_path__ + \"static/media/logo.e70cae76.png\";","export default __webpack_public_path__ + \"static/media/google.0358fb9c.png\";","import { memo } from \"react\";\r\nimport Button from '@mui/material/Button';\r\nimport TextField from '@mui/material/TextField';\r\nimport Grid from '@mui/material/Grid';\r\nimport { auth, provider, provider2, firestore } from \"../firebase/firebase\";\r\nimport Logo from \"../images/logo.png\";\r\nimport Google from \"../images/google.png\";\r\nimport Facebook from \"../images/facebook.png\";\r\nimport \"../styles/Login.css\";\r\n\r\nfunction Login() {\r\n  const googleSignIn = () => {\r\n    auth.signInWithRedirect(provider).catch((e) => alert(e.message));\r\n  };\r\n  const facebookSignIn = () => {\r\n    auth.signInWithRedirect(provider2).catch((e) => alert(e.message));\r\n  };\r\n\r\n  return (\r\n    <div className=\"login\">\r\n      <div className=\"login__container\">\r\n        <img src={Logo} alt=\"FredChat logo\" />\r\n        <div className=\"login__text\">\r\n          <h1>\r\n            Join <span className=\"app_name\">FredChat</span>\r\n          </h1>\r\n        </div>\r\n            <Button onClick={googleSignIn} className=\"btn\">\r\n              <span className=\"sign_in\">Sign in with</span>{\" \"}\r\n              <img src={Google} height=\"20\" width=\"20\" alt=\"google\" />\r\n            </Button>\r\n            <Button onClick={facebookSignIn} className=\"btn\">\r\n              <span className=\"sign_in\">Sign in with</span>{\" \"}\r\n              <img src={Facebook} height=\"20\" width=\"20\" alt=\"google\" />\r\n            </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(Login);\r\n","export default \"data:image/png;base64,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rAYBADAengHApgkAgLGovgOAzRMAACNROt8CyOYJAICR6H0NMDMQAAAjUYqnALJ5AgBgJLqpewDYPAEAMBIb/eRk6w2sDgEAMA5nnzzxs8+1HsHqEAAA4+AZAMxEAACMg08AMBMBADAKbgBkNgIAYARKeAYAsxEAACPQOwFgRgIAYAS6IgCYjQAAGIELa+dPtt7AahEAAKvv7H/99N99tvUIVosAAFhxJXwHALMTAAArzrcAMg8BALDiik8AMAcBALDyihMAZiYAAFZcjf5k6w2sHgEAsOLcBMg8BADAitvmIUDMQQAArLZzj37m/mdaj2D1CACA1Xay9QBWkwAAWGGu/zMvAQCwwmoRAMxHAACsshqeAcBcBADACitOAJiTAABYYf3URwCZjwAAWGGTfu1k6w2sJgEAsLrOffHE3adaj2A1ldYDYBXtPXj0NyPK4dY7Mqi1/PMnHrnvH7TeAWPjBAAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJPS/Ab6MFC7ZR4dJAAAAAElFTkSuQmCC\"","import * as React from \"react\";\r\nimport \"../styles/loader.css\";\r\nimport Logo from \"../images/logo.png\";\r\nexport default function Loader() {\r\n  return (\r\n    <div>\r\n      <div className=\"spinner\">\r\n        <div className=\"container\">\r\n          <div className=\"loader\"></div>\r\n        </div>\r\n      </div>\r\n      <p className=\"logo\">\r\n        <img src={Logo} alt=\"logo\" height=\"30\" width=\"30\" />\r\n        <span>Loading...</span>\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","import { useRef, useState } from \"react\";\r\n\r\nexport default function useFetchData(limitNumber, get,initCount, snapHandler, name) {\r\n\tconst limit = useRef(0);\r\n\tconst dataUnsub = useRef();\r\n\tconst [data, setData] = useState(null);\r\n\tconst snapCount = useRef(0);\r\n\r\n\treturn [data, function fetchData(setScrollFetch) {\r\n\t\tif (limit.current || limit.current === 0) {\r\n            if (limit.current === \"limit attended\") {\r\n                setScrollFetch(false);\r\n                limit.current = null;\r\n            } else {\r\n                setScrollFetch(true);\r\n                limit.current = limit.current + limitNumber;\r\n            };\r\n            if (dataUnsub.current) {\r\n                dataUnsub.current();\r\n            };\r\n            if (initCount) {\r\n            \tsnapCount.current = 0;\r\n            };\r\n            let timeout = null;\r\n            const getData = limit.current ? get.limit(limit.current) : get;\r\n            dataUnsub.current = getData.onSnapshot(snapshot => {\r\n                snapCount.current++;\r\n                const s = () => {\r\n                    const arr = snapHandler(snapshot);\r\n                    setData(arr);\r\n                    setScrollFetch(false);\r\n                    if ((name === \"users\" && arr.length < limit.current - 1) || (name !== \"users\" && arr.length < limit.current)) {\r\n                        limit.current = \"limit attended\";\r\n                        fetchData(setScrollFetch)\r\n                    };\r\n                };\r\n                if (snapshot.docs?.length > 0) {\r\n                    if (snapCount.current >= 2) {\r\n                    \tif (timeout) {\r\n                    \t\tclearTimeout(timeout);\r\n                    \t\ttimeout = null;\r\n                    \t}\r\n                    \ts();\r\n                    } else {\r\n                    \ttimeout = setTimeout(s, 1500)\r\n                    };\r\n                } else if (snapshot.docs?.length === 0) {\r\n                    setData([]);\r\n                    setScrollFetch(false);\r\n                };\r\n            });\r\n        };\r\n        return dataUnsub;\r\n\t}, setData];\r\n};","import { useState, useEffect, memo, useRef } from 'react';\r\nimport Sidebar from './Sidebar';\r\nimport Chat from './Chat';\r\nimport Login from './Login';\r\nimport setOnlineStatus from \"./setOnlineStatus\";\r\nimport { Route, useLocation, Redirect } from 'react-router-dom';\r\nimport { useStateValue } from '../states/StateProvider';\r\nimport Loader from '../loaders/CircularProgress';\r\nimport db, { auth, provider, createTimestamp, messaging } from '../firebase/firebase';\r\nimport { TransitionGroup, Transition, CSSTransition } from \"react-transition-group\";\r\nimport '../styles/App.css';\r\nimport useRoomsData from '../hooks/useRoomsData';\r\nimport scalePage from \"./scalePage\";\r\nimport useFetchData from \"../hooks/useFetchData.js\";\r\n\r\nconst configureNotif = (docID) => {\r\n  messaging.requestPermission()\r\n    .then(() => {\r\n      //console.log('permission granted');\r\n      return messaging.getToken();\r\n    })\r\n    .then((token) => {\r\n      //console.log(token);\r\n      db.collection(\"users\").doc(docID).set({\r\n        token: token\r\n      }, { merge: true })\r\n    })\r\n    .catch(e => {\r\n      //console.log(e.message);\r\n      db.collection(\"users\").doc(docID).set({\r\n        token: \"\"\r\n      }, { merge: true });\r\n    });\r\n}\r\n\r\nfunction App() {\r\n  const [{ user, path, pathID, roomsData, page }, dispatch, actionTypes] = useStateValue();\r\n  const [loader, setLoader] = useState(true);\r\n  const [pwaEvent, setPwaEvent] = useState(undefined);\r\n  const [updating, setUpdating] = useState(false);\r\n  const [checkingVersion, setCheckingVerison] = useState(true);\r\n  const [chats, setChats] = useState(null);\r\n  const [chatsFetched, setChatsFetched] = useState();\r\n  const location = useLocation();\r\n  const [setRoomsData] = useRoomsData();\r\n  const b = useRef([]);\r\n  const menus = [\"/rooms\", \"/search\", \"/users\", \"/chats\"];\r\n\r\n  const [rooms, fetchRooms] = useFetchData(30, db.collection(\"rooms\").orderBy(\"timestamp\", \"desc\"), true, snap => {\r\n    return snap.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data(),\r\n    }));\r\n  }, \"rooms\");\r\n\r\n  const [users, fetchUsers] = useFetchData(30, db.collection(\"users\").orderBy(\"timestamp\", \"desc\"), true, snap => {\r\n    const data = [];\r\n    if (snap.docs.length > 0) {\r\n      snap.docs.forEach((doc) => {\r\n        const id = doc.id > user.uid ? doc.id + user.uid : user.uid + doc.id;\r\n        if (doc.id !== user.uid) {\r\n          data.push({\r\n            ...doc.data(),\r\n            id,\r\n            userID: doc.id,\r\n          });\r\n          setRoomsData(doc.id, id);\r\n        };\r\n      });\r\n    };\r\n    return data;\r\n  }, \"users\");\r\n\r\n  useEffect(() => {\r\n    auth.onAuthStateChanged(authUser => {\r\n      //console.log(\"user change: \", authUser)\r\n      if (authUser) {\r\n        dispatch({ type: actionTypes.SET_USER, user: authUser });\r\n        setLoader(false)\r\n        if (\"serviceWorker\" in navigator && \"PushManager\" in window) {\r\n          //console.log(\"This browser supports notifications and service workers\")\r\n          configureNotif(authUser.uid);\r\n        }\r\n        //console.log(authUser);\r\n        db.collection(\"version\").doc(\"version\").get().then(doc => {\r\n          const version = doc.data().version;\r\n          const previousVersion = localStorage.getItem(\"version\");\r\n          if (previousVersion) {\r\n            //console.log(\"previous version exists in local storage\")\r\n            if (version !== +previousVersion) {\r\n              //console.log(\"new version is not equal to previous version\")\r\n              localStorage.setItem(\"version\", version);\r\n              setUpdating(true);\r\n              auth.signOut();\r\n              auth.signInWithRedirect(provider).catch(e => alert(e.message))\r\n            } else {\r\n              setCheckingVerison(false)\r\n            }\r\n          } else {\r\n            //console.log(\"previous version doesn't exists in local storage\")\r\n            localStorage.setItem(\"version\", version);\r\n            setCheckingVerison(false)\r\n          }\r\n        });\r\n        const ref = db.collection(\"users\").doc(authUser.uid);\r\n        ref.get().then(doc => {\r\n          const data = doc.data();\r\n          if (data) {\r\n            if (data.timestamp) {\r\n              //console.log(\"updating user\")\r\n              return ref.set({\r\n                name: authUser.displayName,\r\n                photoURL: authUser.photoURL,\r\n              }, { merge: true })\r\n            }\r\n          }\r\n          //console.log(\"setting user\")\r\n          return ref.set({\r\n            name: authUser.displayName,\r\n            photoURL: authUser.photoURL,\r\n            timestamp: createTimestamp(),\r\n          }, { merge: true })\r\n        });\r\n      } else {\r\n        dispatch({ type: actionTypes.SET_USER, user: null });\r\n        //console.log(user);\r\n        setLoader(false);\r\n        db.collection(\"version\").doc(\"version\").get().then(doc => {\r\n          const version = doc.data().version;\r\n          const previousVersion = localStorage.getItem(\"version\");\r\n          if (previousVersion) {\r\n            //console.log(\"previous version exists in local storage\")\r\n            if (version !== +previousVersion) {\r\n              //console.log(\"new version is not equal to previous version\")\r\n              localStorage.setItem(\"version\", version);\r\n              setCheckingVerison(false)\r\n            } else {\r\n              setCheckingVerison(false)\r\n            }\r\n          } else {\r\n            //console.log(\"previous version doesn't exists in local storage\")\r\n            localStorage.setItem(\"version\", version);\r\n            setCheckingVerison(false)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('beforeinstallprompt', (e) => {\r\n      // Prevent the mini-infobar from appearing on mobile\r\n      //console.log(\"pwa event executed\");\r\n      e.preventDefault();\r\n      // Stash the event so it can be triggered later.\r\n      setPwaEvent(e);\r\n      // Update UI notify the user they can install the PWA\r\n    });\r\n    window.addEventListener(\"resize\", () => {\r\n      dispatch({ type: \"set_scale_page\", page: scalePage() });\r\n    })\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      db.collection(\"users\").doc(user.uid).collection(\"chats\").orderBy(\"timestamp\", \"desc\").onSnapshot({ includeMetadataChanges: true }, snap => {\r\n        if (snap.docs?.length > 0) {\r\n          snap.docChanges().forEach(change => {\r\n            if (change.type === \"added\") {\r\n              setRoomsData(change.doc.data().userID, change.doc.id);\r\n            };\r\n          });\r\n          if (!snap.metadata.fromCache || (!window.navigator.onLine && snap.metadata.fromCache)) {\r\n            setChats(snap.docs.map(cur => ({\r\n              ...cur.data(),\r\n              id: cur.id\r\n            })));\r\n          };\r\n        } else {\r\n          setChats([]);\r\n        };\r\n      });\r\n      fetchRooms(() => null);\r\n      fetchUsers(() => null);\r\n    };\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    if (chats?.length > 0) {\r\n      if (chats.every(cur => roomsData[cur.id]?.lastMessage)) {\r\n        setChatsFetched(true);\r\n      };\r\n    } else if (chats?.length === 0) {\r\n      setChatsFetched(true);\r\n    }\r\n  }, [chats, roomsData]);\r\n\r\n  useEffect(() => {\r\n    var s;\r\n    if (user) {\r\n      setOnlineStatus(user.uid);\r\n    }\r\n    return () => {\r\n      if (s) {\r\n        s();\r\n      };\r\n    };\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    var id = location.pathname.replace(\"/room/\", \"\");\r\n    menus.forEach(cur => id = id.replace(cur, \"\"))\r\n    dispatch({ type: \"set_path_id\", id });\r\n  }, [location.pathname]);\r\n\r\n  return (\r\n    <div className=\"app\" style={{ ...page }} >\r\n      {page.width <= 760 ?\r\n        <Redirect to=\"/chats\" />\r\n        : <Redirect to=\"/\" />}\r\n      {!user && !loader && !checkingVersion && !updating ?\r\n        <Login />\r\n        : user && !updating && chatsFetched ?\r\n          <div className=\"app__body\">\r\n            <Sidebar chats={chats} pwa={pwaEvent} rooms={rooms} fetchRooms={fetchRooms} users={users} fetchUsers={fetchUsers} />\r\n            <TransitionGroup component={null} >\r\n              {page.width <= 760 ?\r\n                <Transition\r\n                  key={location.pathname.replace(\"/image\", \"\")}\r\n                  timeout={260}\r\n                >\r\n                  {state => (\r\n                    <Route location={location} path={`${path}/room/:roomID`}>\r\n                      <Chat\r\n                        b={b}\r\n                        unreadMessages={chats?.length > 0 ? chats.find(cur => cur.id === pathID)?.unreadMessages : 0}\r\n                        animState={state}\r\n                      />\r\n                    </Route>\r\n                  )}\r\n                </Transition>\r\n                :\r\n                <CSSTransition\r\n                  key={location.pathname.replace(\"/image\", \"\")}\r\n                  timeout={1010}\r\n                  classNames=\"page\"\r\n                >\r\n                  {state => (\r\n                    <Route location={location} path={`${path}/room/:roomID`}>\r\n                      <Chat\r\n                        b={b}\r\n                        unreadMessages={chats?.length > 0 ? chats.find(cur => cur.id === pathID)?.unreadMessages : 0}\r\n                        animState={state}\r\n                      />\r\n                    </Route>\r\n                  )}\r\n                </CSSTransition>\r\n              }\r\n            </TransitionGroup>\r\n          </div> :\r\n          <div className=\"loader__container\">\r\n            <Loader />\r\n          </div>\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(App);\r\n","import {useEffect, useRef} from \"react\";\r\nimport { useStateValue } from \"../states/StateProvider\";\r\nimport db from \"../firebase/firebase\";\r\n\r\nexport default function useRoomsData() {\r\n    const [{ roomsData: initRoomsData }, dispatch] = useStateValue();\r\n    const roomsData = useRef(initRoomsData)\r\n\r\n    useEffect(() => {\r\n        roomsData.current = initRoomsData;\r\n    }, [initRoomsData])\r\n    \r\n    return [function setRoomsData(userID, roomID) {\r\n        if (!roomsData.current[roomID]) {\r\n            const lastMessageListener = db.collection(\"rooms\").doc(roomID).onSnapshot(doc => {\r\n                //console.log(\"last message listener executed with room id: \", roomID)\r\n                dispatch({\r\n                    type: \"update_rooms_data\",\r\n                    dataType: \"lastMessage\",\r\n                    data: doc.data()?.lastMessage,\r\n                    roomID\r\n                });\r\n            });\r\n            const onlineStateListener = db.collection(\"users\").doc(userID).onSnapshot(doc => {\r\n                //console.log(\"onlineState listener executed with room id: \", roomID)\r\n                dispatch({\r\n                    type: \"update_rooms_data\",\r\n                    dataType: \"onlineState\",\r\n                    data: doc.data()?.state,\r\n                    roomID\r\n                });\r\n            });\r\n            dispatch({\r\n                type: \"add_rooms_data\",\r\n                roomID,\r\n                lastMessageListener: lastMessageListener,\r\n                onlineStatelistener: onlineStateListener \r\n            });\r\n        };\r\n    }];\r\n};","import db, { createTimestamp, createTimestamp2, db2 } from \"../firebase/firebase\";\r\n\r\nexport default function setOnlineStatus (uid) {\r\n\ttry {\r\n\t\tconst isOfflineForDatabase = {\r\n\t\t    state: 'offline',\r\n\t\t    last_changed: createTimestamp2,\r\n\t\t    id: uid,\r\n\t\t};\r\n\r\n\t\tconst isOnlineForDatabase = {\r\n\t\t    state: 'online',\r\n\t\t    last_changed: createTimestamp2,\r\n\t\t    id: uid\r\n\t\t};\r\n\t\tconst userStatusFirestoreRef = db.doc('/users/' + uid);\r\n\t\tconst userStatusDatabaseRef = db2.ref('/status/' + uid);\r\n\r\n\t\t// Firestore uses a different server timestamp value, so we'll \r\n\t\t// create two more constants for Firestore state.\r\n\t\tconst isOfflineForFirestore = {\r\n\t\t    state: 'offline',\r\n\t\t    last_changed: createTimestamp(),\r\n\t\t};\r\n\r\n\t\tconst isOnlineForFirestore = {\r\n\t\t    state: 'online',\r\n\t\t    last_changed: createTimestamp(),\r\n\t\t};\r\n\r\n\t\tdb2.ref('.info/connected').on('value', function(snapshot) {\r\n\t\t    if (snapshot.val() === false) {\r\n\t\t        // Instead of simply returning, we'll also set Firestore's state\r\n\t\t        // to 'offline'. This ensures that our Firestore cache is aware\r\n\t\t        // of the switch to 'offline.'\r\n\t\t        userStatusFirestoreRef.set(isOfflineForFirestore,{merge: true});\r\n\t\t        return;\r\n\t\t    };\r\n\r\n\t\t    userStatusDatabaseRef.onDisconnect().set(isOfflineForDatabase).then(function() {\r\n\t\t        userStatusDatabaseRef.set(isOnlineForDatabase);\r\n\r\n\t\t        // We'll also add Firestore set here for when we come online.\r\n\t\t        userStatusFirestoreRef.set(isOnlineForFirestore, {merge: true});\r\n\t\t    });\r\n\t\t});\r\n\t} catch(error) {\r\n\t\tconsole.log(\"error setting onlins status: \", error);\r\n\t}\r\n};","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from 'react-dom';\r\nimport './styles/index.css';\r\nimport App from './components/App';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\nimport { StateProvider } from './states/StateProvider';\r\nimport reducer, { initialState } from \"./states/reducer\";\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\n\r\nif (navigator.mediaDevices === undefined) {\r\n  navigator.mediaDevices = {};\r\n}\r\nif (navigator.mediaDevices.getUserMedia === undefined) {\r\n  navigator.mediaDevices.getUserMedia = function(constraints) {\r\n    var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\r\n    if (!getUserMedia) {\r\n      return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\r\n    }\r\n    return new Promise(function(resolve, reject) {\r\n      getUserMedia.call(navigator, constraints, resolve, reject);\r\n    });\r\n  }\r\n}\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Router>\r\n      <StateProvider initialState={initialState} reducer={reducer}>\r\n        <App />\r\n      </StateProvider>\r\n    </Router>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://cra.link/PWA\r\nserviceWorkerRegistration.register();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\n//reportWebVitals();\r\n"],"sourceRoot":""}